# 全市场回测与板块自适应优化方案

基于用户的需求，我将对“掉头向下监控”脚本进行更广泛的回测，并根据不同板块的特性引入**自适应参数配置**。

## 1. 扩大回测范围 (Backtest Expansion)

为了获得普适性结论，我们将选取 A 股 5 个核心板块的代表性个股（共 15 只）进行回测：

* **科技/TMT (High Beta)**: 中际旭创、工业富联、中兴通讯

* **消费/白马 (Stable Growth)**: 贵州茅台、伊利股份、美的集团

* **金融/红利 (Low Volatility)**: 招商银行、中国平安、长江电力

* **周期/资源 (Cyclical)**: 紫金矿业、中国石油、万华化学

* **新能源 (High Volatility)**: 宁德时代、比亚迪、隆基绿能

## 2. 引入板块自适应参数 (Sector-Adaptive Parameters)

根据之前的初步测试结论，单一参数无法适应所有风格。我们将引入 `SECTOR_CONFIG`，根据个股所属板块自动调整核心参数：

| 参数项         | 默认/稳健 (Defensive) | 高波/科技 (High Beta) | 逻辑说明                       |
| :---------- | :---------------- | :---------------- | :------------------------- |
| **CHOP 阈值** | 61.8              | **55.0**          | 科技股趋势反转快，降低震荡容忍度，更早识别趋势结束。 |
| **放量确认**    | 1.5x              | **2.0x**          | 科技股常有假突破，要求更严苛的放量确认。       |
| **周线趋势**    | 必须死叉              | **死叉 或 MACD柱缩短**  | 科技股波动大，死叉可能滞后，增加柱状图辅助判断。   |

## 3. 执行计划

1. **脚本升级**：

   * 修改 `掉头向下监控.py`，增加 `SECTOR_CONFIG` 字典。

   * 增加简单的板块识别逻辑（基于代码前缀或手动配置列表，实际生产中应调取行业数据，脚本中暂时硬编码典型个股映射）。
2. **批量回测**：

   * 更新 `sandbox_downturn_backtest.py`，纳入 15 只目标个股。

   * 对比“通用参数”与“自适应参数”的回测效果。
3. **数据库更新**：

   * 验证自适应策略有效后，更新至数据库 `rule_scripts` 表。

## 4. 预期交付物

* 升级版 `掉头向下监控.py`（支持板块差异化）。

* 15 只个股的详细回测报告。

* 数据库更新确认。


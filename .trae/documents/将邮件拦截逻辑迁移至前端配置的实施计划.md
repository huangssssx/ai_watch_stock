我已对代码库进行了详细分析，目前的邮件拦截逻辑是硬编码在后端 `monitor_service.py` 中的。

为了实现您的需求，我制定了以下将逻辑迁移到前端配置的方案，并补充了新的拦截条件。

### 1. 现有逻辑与迁移方案

目前后端的硬编码逻辑包括：

* **信号白名单**：只允许 `BUY`, `SELL`, `STRONG_BUY`, `STRONG_SELL`（拦截 `WAIT`）。

* **去重逻辑**：内容与上次一致时拦截。

* **频次豁免**：`STRONG_BUY/SELL `默认豁免频次限制。

**迁移方案**：
我们将扩展现有的 "告警设置" (Alert Settings)，将这些逻辑参数化存储在 `SystemConfig` 表中。

### 2. 新增拦截条件建议

除了您提到的级别（信号）和频次，结合代码中已有的数据分析能力，我建议增加以下条件：

1. **紧急程度 (Urgency)**：

   * 代码中已经计算了 `_duration_severity`（紧急、一般、不紧急）。

   * **应用场景**：您可以配置只接收 "紧急" 的变盘提醒，屏蔽 "不紧急" 的长线建议。
2. **关键词屏蔽 (Keyword Blacklist)**：

   * **应用场景**：如果 AI 分析中包含特定词汇（如 "风险极高"、"流动性差"），即使是买入信号也进行拦截。

### 3. 执行计划

#### 第一步：后端改造 (`backend/services/monitor_service.py`)

* 修改配置读取逻辑，从数据库加载 `alert_config`。

* 替换硬编码判断：

  * `should_send_email` 判断将基于配置的 `allowed_signals` 列表。

  * 增加 `allowed_urgencies` 判断逻辑。

  * 增加 `suppress_duplicates` 开关判断。

* 保持向后兼容：如果未配置，默认使用当前的安全策略。

#### 第二步：前端改造 (`frontend/src/components/Settings.tsx`)

* 升级 `AlertSettings` 组件。

* 新增 **"拦截规则"** 区域：

  * **允许的信号**：多选框 (强烈买入, 买入, 卖出, 强烈卖出, 观望)。

  * **允许的紧急度**：多选框 (紧急, 一般, 不紧急)。

  * **高级选项**：

    * [x] 启用内容去重

    * [x] 强信号(Strong Buy/Sell) 忽略频次限制

#### 第三步：数据结构更新

我们将更新 `alert_rate_limit` 的配置结构（建议重命名为更通用的 `alert_config` 或在原结构扩展）：

```json
{
  "max_per_hour_per_stock": 2,
  "allowed_signals": ["STRONG_BUY", "BUY", "SELL", "STRONG_SELL"],
  "allowed_urgencies": ["紧急", "一般", "不紧急"],
  "suppress_duplicates": true,
  "bypass_rate_limit_for_strong_signals": true
}
```

确认后，我将按照此计划进行开发。

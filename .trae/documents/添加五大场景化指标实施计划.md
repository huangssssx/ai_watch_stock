# 添加五大场景化指标实施计划

为了满足您对不同周期（超短线到超长线）的研判需求，同时避免请求过于频繁和输出内容过长，我将利用 `python_code` 的灵活性，在服务端一次性计算好对应周期的综合数据，只返回最关键的决策信号。

## 1. 指标设计方案

我们将新增以下 5 个指标：

### (1) 场景-超短线 (5分钟/日内)
*   **核心逻辑**：基于 **5分钟K线** (最近4小时) 和 **实时盘口**。
*   **计算内容**：
    *   **趋势**：5分钟 MA5 vs MA20。
    *   **量能**：当前5分钟成交量 vs 20周期均量 (量比)。
    *   **信号**：MACD (5min) 金叉/死叉状态。
*   **输出特点**：极简的一行数据，例如 `{"趋势": "看涨", "量能": "放量(1.5x)", "MACD": "金叉"}`。

### (2) 场景-中短线 (日线波段)
*   **核心逻辑**：基于 **日线** (最近3个月)。
*   **计算内容**：
    *   **均线系统**：MA5/10/20 排列情况 (多头/空头/纠缠)。
    *   **震荡指标**：KDJ J值位置 (超买>100/超卖<0)，RSI 强弱。
    *   **主力资金**：简单的主力资金流向估算 (基于大单计算)。
*   **输出特点**：关注波段买卖点。

### (3) 场景-中长线 (周线趋势)
*   **核心逻辑**：将日线重采样为 **周线** (最近2年)。
*   **计算内容**：
    *   **长期趋势**：周线 MA10 vs MA30 (相当于日线 MA50/150)。
    *   **通道**：周线布林带位置。
    *   **MACD**：周线级别的 MACD 红绿柱趋势。
*   **输出特点**：过滤日线杂波，确认大方向。

### (4) 场景-长线 (月线与估值)
*   **核心逻辑**：**月线** (最近5年) + **PE/PB 估值**。
*   **计算内容**：
    *   **历史位置**：当前价格处于近 5 年的百分位 (如 "处于 15% 低位")。
    *   **月线趋势**：月线 MA5 vs MA20。
    *   **估值状态**：(需调用额外接口获取 PE/PB) 评估是高估还是低估。
*   **输出特点**：适合价值投资判断。

### (5) 场景-超长线 (历史大底)
*   **核心逻辑**：**全历史数据** (上市以来)。
*   **计算内容**：
    *   **历史大底**：距离历史最低价/最高价的幅度。
    *   **年线趋势**：年线级别的方向。
    *   **长期回报**：年化波动率与长期涨幅。
*   **输出特点**：战略性配置参考。

## 2. 技术实现

编写脚本 `scripts/add_scenario_indicators.py`，将上述逻辑封装为 Python 代码存入数据库。
*   **复用接口**：主要复用 `ak.stock_zh_a_hist` (日线)，在代码内部通过 Pandas `resample` 生成周/月/年线，避免多次请求不同周期的接口（除超短线需请求分钟数据外）。
*   **精简输出**：所有指标只保留最后 1 行（当前状态）或最近 3 行关键变化，大幅减少 Token 消耗。

## 3. 执行步骤
1.  创建并编写 Python 脚本。
2.  运行脚本更新数据库。
3.  验证指标 ID 和名称。
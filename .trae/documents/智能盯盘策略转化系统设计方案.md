# 智能盯盘策略转化系统设计方案

人类看过计划后给的修改意见：\
1、我需要的是一个带有前后端的系统，前端 react、后端 python、数据库用 mysql\
2、目前只需要支持一个股票的盯盘操作，报警支持设定报警次数和间隔，目前使用邮件方式发送预警信息\
3、采用分阶段方式完成项目，分为主要模块（设置预警信息部分、看盘部分、公式粘贴部分）这个部分保证我使用 web 可以方便的看见警示信息，发送警示信息到邮箱可以作为第二段，保证每个分段可以单独运作

<br />

<br />

## 1. 核心设计理念

为了实现从“自然语言策略”到“机器自动盯盘”的快速转化，我们需要设计一个中间层——**“策略描述语言 (Strategy DSL)”**。
这个 DSL 采用标准化的 **JSON 格式**。它既是 AI 的输出目标（AI 负责理解语义并填充 JSON），也是盯盘程序的执行依据（程序读取 JSON 并运行逻辑）。

## 2. 系统架构

系统分为三层：

1. **输入层 (AI Agent)**: 接收您的自然语言策略（如“情景一：如期上涨...”），利用 Prompt 将其转化为标准的 JSON 策略配置文件。
2. **执行层 (Strategy Engine)**: 一个 Python 脚本或网页端引擎。

   * 解析 JSON 配置文件。

   * 通过您提供的 `AkShare API Proxy` (`http://alaya.zone:3001`) 获取实时数据和历史数据。

   * 计算指标（如 MA10、成交量均值）。

   * 每隔固定时间（如 3 秒）轮询判断触发条件。
3. **输出层 (Alert System)**: 当条件满足时，输出预警日志、发送通知或模拟交易信号。

## 3. “策略公式” (DSL) 结构设计

我们将策略抽象为四个核心部分，AI 只需要填充这四个部分即可：

* **基本信息 (Meta)**: 股票代码、策略名称。

* **状态变量 (Variables)**: 初始的持仓、成本、当前止损价（这些值会在运行中动态更新）。

* **数据源定义 (Data Source)**: 需要调用哪些 AkShare 接口（如实时行情、K线历史）。

* **规则集 (Rules)**: 核心逻辑，包含 `条件 (Condition)` 和 `动作 (Action)`。

### JSON 结构预览 (示例)

```json
{
  "symbol": "600498",
  "variables": {
    "stop_loss": 24.95,
    "buy_price": 25.65,
    "holding": 800
  },
  "data": [
    {"id": "spot", "api": "stock_zh_a_spot_em", "refresh": 3},
    {"id": "hist", "api": "stock_zh_a_hist", "args": {"period": "daily", "adjust": "qfq"}}
  ],
  "indicators": {
    "ma10": "hist['close'].rolling(10).mean().iloc[-1]",
    "vol_avg_5": "hist['volume'].rolling(5).mean().iloc[-1]"
  },
  "scenarios": [
    {
      "name": "止损触发",
      "condition": "spot['price'] <= variables['stop_loss']",
      "action": "alert('触发止损，立即卖出'); set_variable('holding', 0)"
    }
  ]
}
```

## 4. 实施步骤

1. **定义标准 Schema**: 确立 JSON 的详细字段规范。
2. **编写执行引擎 (Python)**:

   * 编写一个通用的 Python 类 `StrategyRunner`。

   * 实现数据获取模块（对接您的 AkShare API）。

   * 实现指标计算模块（使用 pandas 计算 MA、放量等）。

   * 实现逻辑判断模块（解析并执行 JSON 中的条件）。
3. **验证测试**:

   * 手动将您的“烽火通信”策略转换为 JSON 格式。

   * 模拟运行，验证在不同价格下是否触发正确的预警（如价格跌破 24.95 是否提示止损）。
4. **AI 自动化流程**:

   * 目前自动化流程限于 api 接口还无法启用，目前使用的策略是我人工转换，然后将转换好的公式贴到系统中

## 5. 下一步行动

如果您认可这个方案，我将按照以下顺序执行：

1. **创建** **`strategy_engine.py`**: 实现核心的盯盘逻辑代码。
2. **创建** **`fenghuo_strategy.json`**: 将您提供的“烽火通信”预案手动翻译为标准 JSON 文件，作为第一个模板。
3. **演示运行**: 展示如何加载该策略并开始监控。


## 目标与约束

* 产出一个可直接放进“选股脚本（Screener）”执行的 Python 脚本，结束时暴露 `df`（DataFrame）。

* 只用当前项目已依赖：akshare/tushare/pandas/numpy/datetime（不引入 efinance/talib 等）。

* 结果集控制在 <=100 行，字段遵守 `symbol/name/score/reason`，不写 DB、不创建新 .db。

## 接口兼容策略（按当前 ak 版本自适应）

* 运行时用 `hasattr(ak, ...)` 选择可用接口；同一指标提供多个备选实现。

* 对返回列做映射与健壮清洗（数值列 `pd.to_numeric(errors='coerce')`；金额的“万/亿”字符串用本项目 streamlit 里的转换逻辑）。

* 资金/板块接口不可用时降级：保留其他维度打分，但不会直接报错中断。

## 步骤1：热门板块识别（找热点）

* 拉取行业资金流榜：优先 `ak.stock_sector_fund_flow_rank()`，取“主力净流入(净额/占比)”作为资金热度。

* 拉取行业表现榜：`ak.stock_board_industry_name_em()`，取“涨跌幅/成交额（若有）”作为交易热度。

* 合成板块评分：`sector_score = w1*资金归一化 + w2*涨幅归一化 + w3*成交额归一化(可选)`，取 Top N（默认 8\~12）。

* 可选情绪过滤：对 Top 板块计算“涨停家数”（用一次全市场 spot + 板块成分股 join，按代码段判断 10/20/30% 涨停阈值），要求 >=2。

## 步骤2：板块内强势个股筛选（找资金+走势）

* 候选池：对每个热门板块用 `ak.stock_board_industry_cons_em(symbol=板块)` 取成分股；优先按“成交额/换手率”排序后截断（每板块最多 20 只，整体最多 \~200 只）。

* 个股数据：

  * K线：优先 `ak.stock_zh_a_hist(symbol=..., period='daily', adjust='qfq')` 取近 30\~60 日；若不可用则用 `pro.daily`。

  * 换手率：优先板块成分股表自带列；否则用 `pro.daily_basic`。

  * 主力资金：按优先级尝试 `ak.stock_individual_fund_flow_em` / `ak.stock_individual_fund_flow`；否则用 `pro.moneyflow` 近 5 日计算主力净流入（lg+elg）。

* 过滤条件（全部可参数化）：

  * 连续阳线：近 5 日阳线数 >=4 且累计涨幅 >5%。

  * 放量：近 3 日均量 > 近 20 日均量 \*1.5（用比值，不受“手/股”影响）。

  * 主力净流入：近 3 或 5 日连续为正（若资金接口不可用则该项降级为“Price>VWAP + 成交额/量比”代理）。

  * 走势强悍：近 10 日 max\_pct>=5、min\_pct>=-2、近 5 日回撤<=3%，且收盘在 MA5 上且 MA5 上拐。

## 评分与输出

* 输出字段：`symbol,name,sector,score,reason` + 关键指标（近5阳线数、放量倍数、净流入、MA5、回撤等）。

* 评分构成：板块热度分 + 主力资金分 + 量价强度分 + 风控扣分（如涨停/过热/成交额过低）。

* 最终 `df` 取 Top 50\~100，按 `score` 降序。

## 落地与验证（确认后我会执行）

* 在 `backend/scripts/热门选股.py` 写入完整脚本（需要写好规整的注释，按项目脚本规范）。

* 加一个最小化“自测入口”（不启动服务）：用后端的 `execute_screener_script` 在本地跑一次，检查：

  * `df` 成功输出且列齐全

  * 关键接口缺失时能降级且不中断

  * 结果行数受控

## 可调参数（脚本顶部集中）

* Top 板块数、每板块扫描股票数、资金窗口(3/5/10)、放量倍数、回撤阈值、换手率区间、最低成交额等。

确认这个计划后，我就按以上步骤把脚本实现到 `backend/scripts/热门选股.py` 并跑一次自测。

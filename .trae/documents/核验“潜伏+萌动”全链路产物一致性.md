## 目标
- 抽取单只股票走完 [潜伏+萌动.py](file:///Users/huangchuanjian/workspace/my_projects/ai_watch_stock/backend/scripts/%E6%BD%9C%E4%BC%8F%2B%E8%90%8C%E5%8A%A8.py) 的完整漏斗，并用 Tushare（权威口径）交叉校验关键中间产物与最终筛选是否一致。

## 现状风险点（基于代码静态检查）
- **流通盘口径**：脚本用 `price * liutongguben` 并且过滤 `< 5e9`（即 50 亿“元”市值口径），需要确认 `liutongguben` 的单位是否被正确推断/缩放，否则会直接影响第一层漏斗。
- **换手率口径**：日线 `vol` 存在“手/股”单位陷阱，脚本用 `amount/vol` 与 `close` 的比例做量纲校验；需要用权威 `turnover_rate` 对照，确认换手率阈值与占比计算是否可靠。
- **MA20 支撑**：当前用日线 `close` 作为“现价”近似；若要盘中“现价”，需明确是否改用快照 `price`（本次仅做核验，不改代码）。
- **近20日震荡**：当前实现为“近20日区间振幅 `max/min-1` ≤ 0.15”，但注释仍写“涨跌幅 -12%~+15%”；需要核对这是否符合你的策略定义，并与 Tushare 日线计算结果对照。

## 样本选择
- 选 1 只**非黑名单、数据齐全、近40日正常交易**的 A 股（例如 000001 或 600519；实际以取到 bars/finance/quotes 都不为空为准）。

## 核验步骤（执行时不改代码，仅跑验证脚本/临时命令）
1. **拉取同一股票的 pytdx 数据**
   - `get_security_quotes`：取 `price/amount/vol` 等快照字段。
   - `get_finance_info`：取 `liutongguben` 等字段。
   - `get_security_bars(9, ..., N>=60)`：取日线 close/vol/amount。
2. **逐层复算并记录中间产物**（与脚本同口径）
   - 流通市值（脚本的“流通盘”）：`price * liutongguben`（含脚本的缩放推断逻辑）。
   - 换手率序列：对近 N 天逐日算 `turnover_daily = vol_shares / liutongguben`，并计算 `<=5%` 的天数占比。
   - MA20 支撑：`close_last >= ma20_last*0.98`。
   - 近20日震荡：按脚本当前口径算 `range_amp_20 = max(close[-20:]) / min(close[-20:]) - 1`。
3. **用 Tushare 权威口径对照**
   - `pro.daily(ts_code=...)`：对照 close/vol/amount 的量级与日期对齐。
   - `pro.daily_basic(ts_code=..., fields=...)`：对照 `turnover_rate`、`circ_mv` 等（若字段可用），验证：
     - pytdx 推导的换手率与权威换手率在同量级（允许小误差）。
     - pytdx 推导的流通市值与 `circ_mv`（通常为“万元”口径）换算后一致性。
4. **输出核验报告**
   - 给出：该股票在每一层是否通过、各关键数值（流通市值、换手率占比、MA20、range_amp_20），以及与 Tushare 对照的偏差说明。
   - 若发现问题，明确指出是**单位/日期对齐/口径差异/代码逻辑缺陷**中的哪一类，并定位到相关函数。

## 如发现问题的处理原则
- 本轮只“报告问题与建议修复点”，不直接改动脚本逻辑；如你确认后，再给出最小改动补丁。

确认后我会开始执行上述核验（会运行临时验证命令，但不改脚本代码）。
# 山谷狙击策略完整整改方案

针对 301042 误选导致“接飞刀”的问题，我们将执行以下整改方案，确保策略逻辑升级到最新的学术优化版。

## 1. 核心修复：更新策略脚本库
我们将把数据库中的“山谷狙击选股”脚本强制更新为 `山谷狙击选股策略_optimized.py`。
*   **新特性注入**：
    *   **AR Spread 过滤**：识别空头能量是否衰竭，剔除“杀跌中继”的股票。
    *   **Downside RSV 过滤**：剔除下行波动占比过高（>80%）的单边下跌股。
    *   **BB 算法优化**：更精准的背离识别，减少假信号。
*   **预期效果**：301042（AR分位 0.92，RSV分位 0.93）将被新规则直接“一票否决”，不再进入选股池。

## 2. 执行步骤
1.  **运行更新脚本**：
    `python3 backend/scripts/insert_valley_script.py --file backend/scripts/选股策略/山谷狙击选股策略_optimized.py --id 5 --force`
2.  **清理环境**：删除分析过程中创建的临时诊断脚本 (`debug_stock_301042.py`, `check_db_script_version.py`)。

## 3. 验证与交付
更新完成后，Web 端点击“Run Now”将直接执行新版逻辑。我将向您确认更新结果，并提供新旧逻辑对比总结。
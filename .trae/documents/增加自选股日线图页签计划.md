# 增加“日线图”页签计划

我将为您在“看盘”页面增加一个展示所有自选股日线图的页签。该功能将包含前端界面的改造和后端数据接口的通过。

## 1. 后端修改 (Backend)

需要在 `backend/routers/stocks.py` 中增加一个新的 API 接口，用于获取股票的日线历史数据。

- **新增接口**: `GET /stocks/{symbol}/daily`
- **功能**:
    - 接收股票代码（symbol）。
    - 调用 `akshare.stock_zh_a_hist` 获取最近的日线数据（默认最近 60-100 个交易日）。
    - 返回格式化的 JSON 数据（日期、开盘、收盘、最高、最低、成交量）。
    - 处理股票代码格式（自动移除 `sh`/`sz` 前缀以适配 `akshare` 接口）。

## 2. 前端修改 (Frontend)

### 2.1 新增 API 方法
在 `frontend/src/api.ts` 中增加 `getStockDaily` 方法，调用上述后端接口。

### 2.2 创建图表组件 `StockCharts.tsx`
新建 `frontend/src/components/StockCharts.tsx` 组件：
- **功能**:
    - 接收股票列表作为 props。
    - **自动刷新**: 使用 `useEffect` 在组件挂载时加载数据，并使用 `setInterval` 每 60 秒自动刷新数据。
    - **自适应布局**: 使用 CSS Grid 或 Flex 布局，使图表在不同屏幕尺寸下自动排列（如大屏一行 3-4 个，小屏一行 1-2 个）。
    - **图表绘制**: 使用 `recharts` 库绘制简化的 K 线图（或收盘价走势图，视数据复杂度而定，K 线图更专业）。包含简单的 Tooltip 显示具体价格。
    - **加载状态**: 在数据加载时显示 Loading 骨架屏或旋转图标。

### 2.3 改造“看盘”页面 `StockTable.tsx`
修改 `frontend/src/components/StockTable.tsx`：
- 引入 Ant Design 的 `Tabs` 组件。
- 将原有的表格内容放入 **“列表模式”** Tab。
- 新增 **“走势概览”** Tab，引入并使用 `StockCharts` 组件。
- 只有在切换到“走势概览” Tab 时，`StockCharts` 组件才会挂载并开始请求数据（利用 React 组件生命周期实现“切换即刷新”）。

## 3. 验证计划

1.  **接口测试**: 使用 `curl` 或浏览器直接访问新 API，验证是否能正确返回某只股票（如 `600000`）的数据。
2.  **页面功能**:
    - 验证“列表模式”是否保持原有功能。
    - 切换到“走势概览”，验证是否显示图表。
    - 调整浏览器窗口大小，验证图表布局是否自适应。
    - 停留 1 分钟，观察 Network 请求，验证是否触发自动刷新。

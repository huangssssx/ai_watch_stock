{
  "name": "烽火通信-多情景作战",
  "symbol": "600498",
  "variables": {
    "holding": 800,
    "cash": 0,
    "stop_loss_base": 24.95,
    "stop_loss_add": 0,
    "buy_price": 25.65,
    "target_1": 27.20,
    "state": "holding_initial"
  },
  "data": [
    {
      "id": "spot",
      "api": "stock_zh_a_spot_em",
      "refresh": 3
    },
    {
      "id": "daily",
      "api": "stock_zh_a_hist",
      "args": {
        "period": "daily",
        "adjust": "qfq"
      }
    }
  ],
  "indicators": {
    "current_price": "spot[spot['代码'] == '600498']['最新价'].iloc[0]",
    "ma10": "daily['收盘'].rolling(10).mean().iloc[-1]",
    "vol_avg_5": "daily['成交量'].rolling(5).mean().iloc[-1]",
    "current_vol": "daily['成交量'].iloc[-1]"
  },
  "scenarios": [
    {
      "name": "止损触发",
      "condition": "current_price <= variables['stop_loss_base'] and variables['holding'] > 0",
      "action": "sell_all('触及止损 ' + str(variables['stop_loss_base'])); set_variable('holding', 0)"
    },
    {
      "name": "保本止损上移",
      "condition": "current_price > 26.55 and variables['stop_loss_base'] < variables['buy_price']",
      "action": "set_variable('stop_loss_base', variables['buy_price']); alert('浮盈3%，止损上移至成本价')"
    },
    {
      "name": "加仓突破",
      "condition": "current_price > 26.20 and current_vol > indicators['vol_avg_5'] * 1.5 and variables['holding'] == 800",
      "action": "buy(600, 26.20); set_variable('holding', 1400); set_variable('stop_loss_add', 25.50); alert('放量突破26.20，加仓600股')"
    },
    {
      "name": "第一目标止盈",
      "condition": "current_price >= variables['target_1'] and variables['holding'] >= 800",
      "action": "sell(400); set_variable('holding', variables['holding'] - 400); alert('到达第一目标位，减仓一半')"
    },
    {
      "name": "破位减仓",
      "condition": "current_price < 25.00 and current_price > 24.95 and variables['holding'] == 800",
      "action": "sell(400); set_variable('holding', 400); alert('有效跌破25.00，减仓一半，防守')"
    }
  ]
}

## 目标

把“突破后站稳3日”的强势形态，转化为一个可执行的交易闭环：先筛出强票观察池，再等待回踩缩量触发低吸，最后用一致的风控与退出规则控制回撤与锁定利润。

> 说明：这是交易流程与风险管理框架，不构成收益承诺与投资建议。

## 数据与脚本

- 候选池筛选脚本：`backend/scripts/突破后站稳3日策略/1_突破后站稳3日.py`
- 回踩低吸监控脚本：`backend/scripts/突破后站稳3日策略/2_回踩低吸循环监控.py`
- 候选池样例CSV：`backend/scripts/突破后站稳3日策略/breakout_hold_3days_20260227_231258.csv`

## 第一段：盘后生成“强形态候选池”

### 策略意图

从全市场里找“真正发生突破且随后站稳”的票，作为未来几天的重点跟踪池。此阶段不做买卖点，只做“形态筛选”和“观察池构建”。

### 关键位

- `High60`：60日最高价（滚动窗口）
- `MA60`：60日均线
- `MA120`：120日均线

关键点：脚本在突破判断中优先使用关键位的前一日值（`*_prev`），减少当日数据对阈值的自洽影响。

### 突破判定（固定用 T-3）

脚本固定把倒数第4根K视为突破日（T-3），倒数第1根K视为最新交易日（T）。这样可以避免“历史任意一天满足就算命中”导致命中泛滥。

突破核心条件：

- 放量：`vol / ma20_vol_prev >= 1.5` 且 `<= 4.0`
- 价格突破阈值：
  - `High60`：`close >= high60_prev * 1.005`
  - `MA60/MA120`：`close >= ma_prev * 1.015`
- 穿越式突破：要求“前一日收盘 < 阈值 && 当日收盘 >= 阈值”，避免长期站在阈值之上的票被误判为突破

### 站稳3日（T-2、T-1、T）

突破后连续三日的稳定性检验：

- 三天最低收盘不低于：`key_level * 0.99`
- 三天内至少2天收盘不低于：`key_level`
- 三天每天成交量不低于：`ma20_vol_prev * 0.5`

### 输出与含义

输出CSV包含：

- `key_level_type/key_level`：后续回踩交易的锚点
- `breakout_date/breakout_price`：突破发生信息（用于后续止盈与复盘对照）
- `breakout_vol_ratio`：突破放量强度
- `stand_days_above/min_close_ratio`：站稳质量

这些字段是第二段“回踩低吸”与第三段“退出风控”的输入。

## 第二段：监控候选池的“回踩缩量低吸”触发

### 策略意图

用第一段确定的 `key_level` 作为锚点，避免追高；等待价格回踩关键位附近，同时成交量显著缩小，在风险更可控的位置寻找介入机会。

### 触发条件（按脚本实现）

对候选池中的每只股票，取最新交易日（T）的日线数据，触发条件为：

- 不破硬止损：`last_close >= key_level * 0.98`
- 回踩幅度在可交易区间：
  - `pullback_ratio = (key_level - last_close) / key_level`
  - 要求 `pullback_ratio ∈ [-1%, +5%]`
- 缩量：`last_vol <= prev_vol * 0.5`

脚本还会估算“回踩持续天数”（最多向前看5天），用于对触发结果排序与优先级判断：

- 若历史某日满足 `low >= key_level*0.98 且 close <= key_level*1.01`，则计为处于回踩区间

### 输出与用途

输出包含：

- `hard_stop`：硬止损线（key_level*0.98）
- `pullback_ratio/pullback_days`：回踩深度与持续时间
- `vol_ratio_prev/vol_ratio_ma20`：缩量强弱
- `reason`：触发原因摘要

该输出可以直接作为“当日/次日交易计划”候选清单。

## 第三段：把信号固化为可执行的交易规则

两段脚本提供了“入场环境（强形态）+ 入场触发（回踩缩量）”。能否长期稳定，取决于一致的仓位、止损、止盈与退出规则。

### 建仓（降低一次买错的概率）

推荐二段式（不依赖新增指标）：

1) 触发回踩缩量信号后，小仓位试仓（只用计划仓位的一部分）  
2) 若随后价格重新回到 `key_level` 上方并表现转强，再加仓到计划仓位

如果不方便二段式，则坚持“小仓位一次性”，宁可错过也不要重仓赌一次回踩。

### 止损（必须硬执行）

以脚本内置的锚点为主：

- 硬止损线：`key_level * 0.98`
- 一旦触发，优先盘中处理，避免隔夜跳空扩大亏损

### 止盈与退出（防盈利回吐）

给出一套只依赖现有字段即可执行的框架：

- 分段止盈：当价格回到/接近 `breakout_price` 或前高区域，先减仓锁定部分利润
- 移动止损：当浮盈扩大后，将止损线从 `key_level*0.98` 上移到 `key_level` 附近或最近低点
- 时间止损：回踩低吸后若若干天内无法重新走强（不再扩展上行空间），退出把资金留给更顺畅的票

### 仓位与单笔风险上限（核心生存规则）

统一用“单笔最大可承受亏损”反推仓位：

- 风险 = 允许亏损金额
- 单股风险 = 买入价 - 止损价（止损价通常为 `key_level*0.98`）
- 仓位 = 风险 / 单股风险

目标是：连续多次失误也不会出现不可恢复的回撤。

## 每日运行节奏（闭环）

### 盘后（每日一次）

1) 跑 `1_突破后站稳3日.py` 更新候选池CSV  
2) 将输出CSV作为“观察池清单”（只关注近期突破的票）

### 盘后/盘中监控（循环）

1) 用 `2_回踩低吸循环监控.py` 读取候选池CSV  
2) 输出“回踩缩量触发名单”作为次日计划或当日重点观察

### 执行与复盘（每周）

- 记录每次触发后的入场、止损、止盈结果
- 统计胜率、盈亏比、最大回撤
- 若要调参，优先从以下阈值入手并一次只改一项：
  - 回踩幅度区间（-1%~+5%）
  - 缩量阈值（<=昨日50%）
  - 突破放量阈值（>=1.5 且 <=4.0）

## 常用命令示例

一次性生成候选池（示例）：

```bash
python3 "backend/scripts/突破后站稳3日策略/1_突破后站稳3日.py" --bars 150 --max-stocks 0
```

用候选池跑一轮回踩低吸扫描（示例）：

```bash
python3 "backend/scripts/突破后站稳3日策略/2_回踩低吸循环监控.py" --once --input "backend/scripts/突破后站稳3日策略/breakout_hold_3days_20260227_231258.csv" --bars 160
```

持续循环监控（示例）：

```bash
python3 "backend/scripts/突破后站稳3日策略/2_回踩低吸循环监控.py" --input "backend/scripts/突破后站稳3日策略/breakout_hold_3days_20260227_231258.csv" --bars 160 --interval 60
```

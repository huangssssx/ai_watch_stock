# ç¡¬è§„åˆ™è„šæœ¬å¯¼å‡º

- æ¥æº DBï¼š`/Users/huangchuanjian/workspace/my_projects/ai_watch_stock/backend/stock_watch.db`
- å¯¼å‡ºè¡¨ï¼š`rule_scripts`
- æ¡ç›®æ•°ï¼š`7`

## ç›®å½•
- [è§¦åº•åå¼¹ç›‘æ§](#è§¦åº•åå¼¹ç›‘æ§)
- [æ‰å¤´å‘ä¸‹ç›‘æ§](#æ‰å¤´å‘ä¸‹ç›‘æ§)
- [çƒ­é—¨è‚¡ æ´—ç›˜&ä¼ç¨³ç›‘æ§](#çƒ­é—¨è‚¡-æ´—ç›˜&ä¼ç¨³ç›‘æ§)
- [åŒ—äº¬å›æ­£ 1 æœˆ 7 æ—¥ç›‘æ§è„šæœ¬](#åŒ—äº¬å›æ­£-1-æœˆ-7-æ—¥ç›‘æ§è„šæœ¬)
- [å››å·ä¹æ´² è·Ÿè¸ª](#å››å·ä¹æ´²-è·Ÿè¸ª)
- [ä¸‡å‘é’±æ½®ç›¯ç›˜è„šæœ¬](#ä¸‡å‘é’±æ½®ç›¯ç›˜è„šæœ¬)
- [åŒå‘çŒæ€ç›‘æ§ç­–ç•¥](#åŒå‘çŒæ€ç›‘æ§ç­–ç•¥)

## è§¦åº•åå¼¹ç›‘æ§

- idï¼š`6`
- is_pinnedï¼š`1`
- updated_atï¼š`2026-01-18 07:18:00`
- descriptionï¼šæ•æ‰å¤„äºä¸‹è·Œè¶‹åŠ¿æˆ–ä½ä½ç›˜æ•´ä¸­ï¼Œå‡ºç°æŠ€æœ¯é¢åè½¬ä¿¡å·çš„è‚¡ç¥¨ã€‚V5.1ä¼˜åŒ–ç‰ˆï¼šå¼•å…¥RSI(Wilder)<35ã€å¸ƒæ—å¸¦ä¸‹è½¨æ”¯æ’‘ã€é‡èƒ½ç¡®è®¤ç­‰é«˜èƒœç‡æ¡ä»¶ã€‚

### code

```python
# ==============================================================================
# è§¦åº•åå¼¹ç›‘æ§ V5.1 (Valley Sniper Optimized)
# ------------------------------------------------------------------------------
# ç›®æ ‡ï¼šæ•æ‰å¤„äºä¸‹è·Œè¶‹åŠ¿æˆ–ä½ä½ç›˜æ•´ä¸­ï¼Œå‡ºç°æŠ€æœ¯é¢åè½¬ä¿¡å·çš„è‚¡ç¥¨ã€‚
# æ ¸å¿ƒé€»è¾‘ (ç»è¿‡å›æµ‹ä¼˜åŒ– WinRate > 70%)ï¼š
# 1. ä½ç½®ï¼šé•¿æœŸè¶‹åŠ¿å‘ä¸‹ (Close < MA60)
# 2. è¶…è·Œï¼šRSI(Wilder) è¿‘5æ—¥æ›¾ < 35
# 3. æ”¯æ’‘ï¼šè¿‘3æ—¥æ›¾è§¦åŠå¸ƒæ—å¸¦ä¸‹è½¨ (Bollinger Lower Band)
# 4. å¯åŠ¨ï¼šç«™ä¸ŠMA5 + æ”¶é˜³çº¿ + MA5èµ°å¹³/å‘ä¸Š + æ”¾é‡ (Vol > MA5_Vol)
# 5. å…±æŒ¯ï¼šMACDé‡‘å‰ æˆ– RSIå›å‡
# ==============================================================================

import akshare as ak
import pandas as pd
import datetime
import numpy as np

# 1. åˆå§‹åŒ–
triggered = False
signal = "WAIT"
message = "ç›‘æ§ä¸­ï¼šç­‰å¾…è§¦åº•åå¼¹ä¿¡å·..."

try:
    # 2. é¢„å¤„ç† Symbol
    symbol_code = symbol
    if symbol.startswith(("sh", "sz", "bj")):
        symbol_code = symbol[2:]

    # 3. è·å–æ•°æ®
    now = datetime.datetime.now()
    # è·å–è¶³å¤Ÿé•¿çš„å†å²æ•°æ® (250å¤©) ä»¥ç¡®ä¿ MA60/å‡çº¿/å¸ƒæ—å¸¦ ç¨³å®š
    start_dt = (now - datetime.timedelta(days=250)).strftime("%Y%m%d")
    end_dt = now.strftime("%Y%m%d")
    
    df = ak.stock_zh_a_hist(symbol=symbol_code, period="daily", start_date=start_dt, end_date=end_dt, adjust="qfq")

    if df is None or df.empty or len(df) < 60:
        message = "æœªè§¦å‘ï¼šå†å²æ•°æ®ä¸è¶³"
    else:
        # 4. æŒ‡æ ‡è®¡ç®—
        close = pd.to_numeric(df["æ”¶ç›˜"], errors="coerce")
        open_price = pd.to_numeric(df["å¼€ç›˜"], errors="coerce")
        high = pd.to_numeric(df["æœ€é«˜"], errors="coerce")
        low = pd.to_numeric(df["æœ€ä½"], errors="coerce")
        vol = pd.to_numeric(df["æˆäº¤é‡"], errors="coerce")
        
        # å‡çº¿
        ma5 = close.rolling(window=5).mean()
        ma60 = close.rolling(window=60).mean()
        vol_ma5 = vol.rolling(window=5).mean()
        
        # å¸ƒæ—å¸¦ (20, 2)
        bb_mid = close.rolling(window=20).mean()
        bb_std = close.rolling(window=20).std()
        bb_lower = bb_mid - 2 * bb_std
        
        # MACD (12, 26, 9)
        exp1 = close.ewm(span=12, adjust=False).mean()
        exp2 = close.ewm(span=26, adjust=False).mean()
        macd = exp1 - exp2
        signal_line = macd.ewm(span=9, adjust=False).mean()
        hist = (macd - signal_line) * 2
        
        # RSI (Wilder's Smoothing)
        delta = close.diff()
        up = delta.clip(lower=0)
        down = -1 * delta.clip(upper=0)
        ma_up = up.ewm(com=13, adjust=False).mean()
        ma_down = down.ewm(com=13, adjust=False).mean()
        rsi = 100 - (100 / (1 + ma_up / ma_down))

        # è·å–æœ€æ–°å€¼ (ä»Šæ—¥ -1, æ˜¨æ—¥ -2)
        curr_price = close.iloc[-1]
        curr_open = open_price.iloc[-1]
        curr_low = low.iloc[-1]
        curr_ma5 = ma5.iloc[-1]
        curr_ma60 = ma60.iloc[-1]
        curr_vol = vol.iloc[-1]
        
        curr_macd = macd.iloc[-1]
        curr_signal = signal_line.iloc[-1]
        curr_rsi = rsi.iloc[-1]
        
        prev_ma5 = ma5.iloc[-2]
        prev_vol_ma5 = vol_ma5.iloc[-2]
        prev_macd = macd.iloc[-2]
        prev_signal = signal_line.iloc[-2]
        prev_rsi = rsi.iloc[-2]

        # 5. é€»è¾‘åˆ¤æ–­
        reasons = []
        
        # A. ä½ç½®ä¸è¶‹åŠ¿
        # 1. å¤„äºç©ºå¤´è¶‹åŠ¿ (è‚¡ä»· < MA60)
        is_below_trend = curr_price < curr_ma60
        # 2. è¿‘æœŸè¶…è·Œ (RSIè¿‘5æ—¥æ›¾ < 35)
        is_oversold = (rsi.iloc[-5:].min() < 35)
        # 3. å¸ƒæ—å¸¦æ”¯æ’‘ (è¿‘3æ—¥æ›¾è§¦åŠä¸‹è½¨)
        is_bb_support = False
        for i in range(3):
            if low.iloc[-(i+1)] <= bb_lower.iloc[-(i+1)]:
                is_bb_support = True
                break
        
        if is_below_trend and is_oversold:
            # B. å¯åŠ¨ä¿¡å·
            # 1. æœ‰æ•ˆçªç ´MA5 (ç«™ä¸ŠMA5 ä¸” æ”¶é˜³çº¿ ä¸” MA5ä¸è·Œ)
            is_solid_breakout = (curr_price > curr_ma5) and (curr_price > curr_open) and (curr_ma5 >= prev_ma5)
            
            # 2. é‡èƒ½ç¡®è®¤ (ä»Šæ—¥æˆäº¤é‡ > æ˜¨æ—¥5æ—¥å‡é‡)
            is_volume_confirmed = curr_vol > prev_vol_ma5
            
            if is_solid_breakout and is_volume_confirmed:
                
                # C. è¾…åŠ©æŒ‡æ ‡å…±æŒ¯ (MACDé‡‘å‰ æˆ– RSIå›å‡)
                macd_golden_cross = (prev_macd < prev_signal) and (curr_macd > curr_signal)
                rsi_rebound = (prev_rsi < 40) and (curr_rsi > prev_rsi)
                
                if macd_golden_cross:
                    reasons.append("MACDé‡‘å‰")
                if rsi_rebound:
                    reasons.append(f"RSIå›å‡({int(prev_rsi)}->{int(curr_rsi)})")
                
                # åªæœ‰å½“æ»¡è¶³æ ¸å¿ƒæ¡ä»¶ä¸”æœ‰æŒ‡æ ‡å…±æŒ¯æ—¶è§¦å‘
                if (macd_golden_cross or rsi_rebound):
                    # åªæœ‰åœ¨å¸ƒæ—å¸¦æ”¯æ’‘ç¡®è®¤çš„æƒ…å†µä¸‹æ‰è¢«è®¤ä¸ºæ˜¯é«˜èƒœç‡æœºä¼š
                    if is_bb_support:
                        triggered = True
                        signal = "BUY"
                        
                        # è®¡ç®—é˜²å®ˆä½ (ä»Šæ—¥æœ€ä½ä»·)
                        defense_price = curr_low
                        
                        message = f"ğŸš€ã€è§¦åº•åå¼¹V5ã€‘ç«™ä¸ŠMA5 + é‡ä»·é½å‡ + {'+'.join(reasons)} | ç°ä»·:{curr_price:.2f} | é˜²å®ˆ:{defense_price:.2f}"
                    else:
                        message = "æœªè§¦å‘ï¼šè™½æœ‰åå¼¹ï¼Œä½†è¿‘æœŸæœªè§¦åŠå¸ƒæ—ä¸‹è½¨ï¼Œæ”¯æ’‘ä¸å¼º"
                else:
                    message = "æœªè§¦å‘ï¼šç¼ºä¹æŒ‡æ ‡å…±æŒ¯ (MACD/RSI)"
            else:
                if not is_solid_breakout:
                    message = f"æœªè§¦å‘ï¼šåå¼¹åŠ›åº¦ä¸è¶³ (æœªç«™ç¨³MA5æˆ–éé˜³çº¿) ç°ä»·:{curr_price:.2f}"
                elif not is_volume_confirmed:
                    message = f"æœªè§¦å‘ï¼šæ— é‡åå¼¹ (Vol ratio: {curr_vol/prev_vol_ma5:.1f})"
        else:
            message = "æœªè§¦å‘ï¼šéä½ä½/å¼±åŠ¿/è¶…è·ŒåŒºé—´"

except Exception as e:
    triggered = False
    signal = "WAIT"
    message = f"è„šæœ¬é”™è¯¯ï¼š{str(e)}"
    print(f"[Error] {e}")
```

## æ‰å¤´å‘ä¸‹ç›‘æ§

- idï¼š`7`
- is_pinnedï¼š`1`
- updated_atï¼š`2026-01-16 07:06:56`
- descriptionï¼šåŒºåˆ†æŠ€æœ¯æ€§è°ƒæ•´ä¸è¶‹åŠ¿åè½¬ï¼šç›‘æµ‹è·Œç ´MA20ã€æ”¾é‡æ€è·Œç­‰å±é™©ä¿¡å·ã€‚

### code

```python
# ==============================================================================
# æ‰å¤´å‘ä¸‹ç›‘æ§ (Downturn Monitor) - v4.0 Aè‚¡å®æˆ˜ç»ˆæç‰ˆ
# ------------------------------------------------------------------------------
# æ ¸å¿ƒå‡çº§ç‚¹ï¼š
# 1. åŠ¨æ€æ³¢åŠ¨ç‡ç”»åƒ (æ— ç¡¬ç¼–ç æ¿å—)
# 2. å‘¨çº¿åŠ¨èƒ½è¡°ç«­ (MACDçº¢æŸ±ç¼©çŸ­å…ˆè¡ŒæŠ¥è­¦)
# 3. é™·é˜±ç›‘æ§ (æ—¥å†…ç‚¸æ¿ + è·³ç©ºä½å¼€)
# 4. é»‘å¤©é¹…æ•æ‰ (Low CHOP Breakout)
# ==============================================================================

# ç¡®ä¿åœ¨æ‰§è¡Œä¸Šä¸‹æ–‡ä¸­å¼•å…¥ä¾èµ–
import talib
import numpy as np
import pandas as pd
import akshare as ak
import datetime

# --- 1. å®ç›˜æ•°æ®è·å– (Real-time Data) ---
def get_realtime_data_merged(symbol_input):
    """
    è·å–â€œå†å²æ—¥çº¿ + å®æ—¶å¿«ç…§â€æ‹¼æ¥åçš„å®Œæ•´ DataFrame
    """
    # æ˜¾å¼å¼•å…¥ä¾èµ–ï¼Œé˜²æ­¢é—­åŒ…é—®é¢˜
    import pandas as pd
    import akshare as ak
    import datetime
    
    try:
        # 1. è·å–å†å²æ—¥çº¿ (æˆªæ­¢åˆ°æ˜¨å¤©)
        # å¼ºåˆ¶åŒ—äº¬æ—¶é—´ (UTC+8)
        now_cn = datetime.datetime.utcnow() + datetime.timedelta(hours=8)
        
        yesterday = (now_cn - datetime.timedelta(days=1)).strftime("%Y%m%d")
        start_date = (now_cn - datetime.timedelta(days=400)).strftime("%Y%m%d")
        
        # å¤„ç† symbol æ ¼å¼
        symbol_code = symbol_input
        if symbol_input.startswith(("sh", "sz", "bj")):
            symbol_code = symbol_input[2:]
            
        # æ‹‰å–å†å²
        df_hist = ak.stock_zh_a_hist(symbol=symbol_code, period="daily", start_date=start_date, end_date=yesterday, adjust="qfq")
        if df_hist is None or df_hist.empty:
            return pd.DataFrame()
            
        df_hist = df_hist.rename(columns={
            "æ—¥æœŸ": "date", "å¼€ç›˜": "open", "æ”¶ç›˜": "close", 
            "æœ€é«˜": "high", "æœ€ä½": "low", "æˆäº¤é‡": "volume"
        })
        df_hist["date"] = pd.to_datetime(df_hist["date"])
        
        # 2. è·å–å®æ—¶å¿«ç…§ (Spot Data) - ä»…åœ¨äº¤æ˜“æ—¶é—´æœ‰æ•ˆ
        # æ³¨æ„ï¼šè‹¥ç›˜åè¿è¡Œï¼Œspotæ•°æ®å¯èƒ½å·²åœç•™åœ¨15:00ï¼Œä¹Ÿæ˜¯æœ‰æ•ˆçš„
        try:
            spot_df = ak.stock_zh_a_spot_em()
            current_row = spot_df[spot_df["ä»£ç "] == symbol_code]
            
            if not current_row.empty:
                # 3. æ„é€ ä»Šæ—¥çš„ Bar
                today_date = pd.to_datetime(now_cn.date())
                
                today_bar = pd.DataFrame({
                    "date": [today_date],
                    "open": [float(current_row.iloc[0]["ä»Šå¼€"])],
                    "high": [float(current_row.iloc[0]["æœ€é«˜"])],
                    "low": [float(current_row.iloc[0]["æœ€ä½"])],
                    "close": [float(current_row.iloc[0]["æœ€æ–°ä»·"])],
                    "volume": [float(current_row.iloc[0]["æˆäº¤é‡"])]
                })
                
                # 4. æ‹¼æ¥
                df_merged = pd.concat([df_hist, today_bar], ignore_index=True)
                # å»é‡ (é˜²æ­¢ akshare å†å²æ•°æ®å·²åŒ…å«ä»Šæ—¥)
                df_merged = df_merged.sort_values("date").drop_duplicates(subset=["date"], keep="last")
                return df_merged
        except:
            pass
            
        return df_hist

    except Exception as e:
        # ä½¿ç”¨ str(e) è€Œä¸æ˜¯ print ä»¥é˜² print ä¸å¯ç”¨
        return pd.DataFrame()

# --- 2. åŠ¨æ€æ³¢åŠ¨ç‡ç”»åƒ ---
def get_volatility_profile_rolling(df, window=60):
    import talib
    import pandas as pd
    
    high = df["high"].values
    low = df["low"].values
    close = df["close"].values
    
    natr = talib.NATR(high, low, close, timeperiod=14)
    natr_s = pd.Series(natr, index=df.index)
    avg_natr = natr_s.rolling(window=window, min_periods=1).mean()
    
    params = pd.DataFrame(index=df.index)
    # Add avg_natr to params
    params['avg_natr'] = avg_natr
    
    params['type'] = 'NORMAL'
    params['chop_thresh'] = 61.8
    params['vol_mul'] = 1.5
    params['kama_slow_T'] = 20
    params['rsi_limit'] = 75
    params['ignore_weakening'] = False
    params['kama_fast_T'] = 8
    params['use_ma60_filter'] = False
    
    # High Beta (NATR > 3.5)
    mask_high = avg_natr > 3.5
    params.loc[mask_high, 'type'] = 'HIGH_BETA'
    params.loc[mask_high, 'chop_thresh'] = 50.0
    params.loc[mask_high, 'vol_mul'] = 2.0
    params.loc[mask_high, 'kama_slow_T'] = 30
    params.loc[mask_high, 'rsi_limit'] = 75
    params.loc[mask_high, 'kama_fast_T'] = 5
    
    # Low Beta (NATR < 2.0)
    mask_low = avg_natr < 2.0
    params.loc[mask_low, 'type'] = 'LOW_BETA'
    params.loc[mask_low, 'chop_thresh'] = 65.0
    params.loc[mask_low, 'vol_mul'] = 1.2
    params.loc[mask_low, 'kama_slow_T'] = 25
    params.loc[mask_low, 'rsi_limit'] = 80
    params.loc[mask_low, 'ignore_weakening'] = True
    params.loc[mask_low, 'kama_fast_T'] = 12
    params.loc[mask_low, 'use_ma60_filter'] = True
    
    return params

# --- 3. å‘¨çº¿è¶‹åŠ¿ ---
def get_weekly_status_rolling(df):
    import talib
    import pandas as pd
    import numpy as np
    
    df_w = df.resample("W").agg({
        "open": "first", "high": "max", "low": "min", "close": "last", "volume": "sum"
    }).dropna()
    
    if len(df_w) < 26:
        return pd.Series("NEUTRAL", index=df.index)
        
    close_w = df_w["close"].values
    macd, signal, hist = talib.MACD(close_w, fastperiod=12, slowperiod=26, signalperiod=9)
    
    status_w = []
    for i in range(len(close_w)):
        c_macd = macd[i]
        c_sig = signal[i]
        c_hist = hist[i]
        p_hist = hist[i-1] if i > 0 else 0
        
        if np.isnan(c_macd) or np.isnan(c_sig):
            status_w.append("NEUTRAL")
            continue
            
        if c_macd < c_sig:
            status_w.append("DOWN")
        elif (c_macd > c_sig) and (c_hist < p_hist * 0.8) and (c_hist > 0):
            status_w.append("WEAKENING")
        else:
            status_w.append("UP")
            
    status_series_w = pd.Series(status_w, index=df_w.index)
    status_daily = status_series_w.reindex(df.index, method='ffill').fillna("NEUTRAL")
    return status_daily

# --- Main Logic ---
triggered = False
signal = "WAIT"
message = "ç›‘æ§ä¸­..."

try:
    # å†æ¬¡ç¡®ä¿ä¸»é€»è¾‘ä¸­æœ‰ä¾èµ–
    import talib
    import pandas as pd
    import numpy as np
    
    # 1. è·å–æ•°æ®
    # 'symbol' å˜é‡ç”±å¤–éƒ¨ç¯å¢ƒæä¾›
    df = get_realtime_data_merged(symbol)
    
    if df is None or len(df) < 60:
        message = "æ•°æ®ä¸è¶³ (éœ€ > 60 å¤©)"
    else:
        # 2. è®¡ç®—æŒ‡æ ‡
        df["date"] = pd.to_datetime(df["date"])
        df.set_index("date", inplace=True)
        
        close = df["close"].values
        high = df["high"].values
        low = df["low"].values
        volume = df["volume"].values.astype(float)
        
        # Profile
        profile_df = get_volatility_profile_rolling(df)
        p = profile_df.iloc[-1] # Take last row parameters
        
        # Indicators
        kama_slow = talib.KAMA(close, timeperiod=int(p['kama_slow_T']))
        kama_fast = talib.KAMA(close, timeperiod=int(p['kama_fast_T']))
        ma60 = talib.SMA(close, timeperiod=60)
        atr = talib.ATR(high, low, close, timeperiod=14)
        rsi = talib.RSI(close, timeperiod=14)
        vol_ma5 = talib.SMA(volume, timeperiod=5)
        
        # CHOP
        tr1 = talib.TRANGE(high, low, close)
        sum_tr = pd.Series(tr1).rolling(14).sum()
        range_hl = pd.Series(high).rolling(14).max() - pd.Series(low).rolling(14).min()
        range_hl = range_hl.replace(0, np.nan)
        chop = 100 * np.log10(sum_tr / range_hl) / np.log10(14)
        
        weekly_status_s = get_weekly_status_rolling(df)
        
        # 3. è·å–å½“å‰åˆ‡ç‰‡ (Last Row)
        curr_close = close[-1]
        prev_close = close[-2]
        prev_low = low[-2]
        curr_vol = volume[-1]
        curr_vol_ma5 = vol_ma5[-1]
        curr_rsi = rsi[-1]
        curr_chop = chop.iloc[-1]
        curr_weekly = weekly_status_s.iloc[-1]
        
        curr_kama_slow = kama_slow[-1]
        curr_kama_fast = kama_fast[-1]
        curr_ma60 = ma60[-1]
        
        danger_reasons = []
        warning_reasons = []
        
        # --- LOGIC CORE v4.0 ---
        
        # A. Low CHOP Breakout (Black Swan)
        if (curr_chop < 38.2) and (curr_close < curr_kama_slow):
            danger_reasons.append("Low_CHOP_Breakout")
            
        # B. Gap Down
        curr_open = df["open"].iloc[-1]
        if (curr_open < prev_low * 0.995) and (curr_close < prev_low):
            danger_reasons.append("Gap_Down")
            
        # C. Zhaban Trap
        day_high = high[-1]
        day_high_pct = (day_high - prev_close) / prev_close
        drawdown = (day_high - curr_close) / day_high
        if (day_high_pct > 0.05) and (drawdown > 0.04):
            danger_reasons.append("Zhaban_Trap")
            
        # D. Trend Breakdown
        trend_broken = (curr_close < curr_kama_slow)
        
        # Low Beta Filter: Must also break MA60
        if trend_broken and p['use_ma60_filter']:
            if curr_close > curr_ma60:
                trend_broken = False
        
        # High Beta Filter: If RSI > 60, don't sell
        if trend_broken and (p['type'] == 'HIGH_BETA') and (curr_rsi > 60):
            trend_broken = False
            
        if trend_broken:
            if curr_weekly == "DOWN":
                if (curr_chop < p['chop_thresh']) or (curr_vol > p['vol_mul'] * curr_vol_ma5):
                    danger_reasons.append("Trend_Break_Weekly_Down")
            elif curr_weekly == "WEAKENING":
                if not p['ignore_weakening']:
                    danger_reasons.append("Trend_Break_Weekly_Weak")
                    
        # E. Limit Up Trap
        prev_pct = (close[-2] - close[-3]) / close[-3] if len(close) > 2 else 0
        if (prev_pct > 0.09) and (curr_close < prev_close):
            danger_reasons.append("Limit_Up_Trap")
            
        # F. Churning
        if (curr_vol > 2.0 * curr_vol_ma5) and (abs(curr_close - prev_close)/prev_close < 0.01):
            warning_reasons.append("Churning")
            
        # G. Overheat
        if (curr_rsi > p['rsi_limit']) and (curr_close < curr_kama_fast):
            warning_reasons.append("RSI_Overheat")
            
        # Output Construction
        if danger_reasons:
            triggered = True
            signal = "STRONG_SELL"
            message = f"ğŸ’€ã€å±é™©|{p['type']}ã€‘{' + '.join(danger_reasons)}"
        elif warning_reasons:
            triggered = True
            signal = "SELL"
            message = f"ğŸ“‰ã€é¢„è­¦|{p['type']}ã€‘{' + '.join(warning_reasons)}"
        else:
            triggered = False
            signal = "SAFE"
            # Access avg_natr from parameters dataframe row 'p'
            message = f"âœ…ã€å®‰å¥½|{p['type']}ã€‘è¶‹åŠ¿:{curr_weekly} | æ³¢åŠ¨:{p['avg_natr']:.1f}"

except Exception as e:
    triggered = False
    signal = "WAIT"
    message = f"Script Error: {str(e)}"
    # print(f"Error: {e}")
```

## çƒ­é—¨è‚¡ æ´—ç›˜&ä¼ç¨³ç›‘æ§

- idï¼š`5`
- is_pinnedï¼š`0`
- updated_atï¼š`2026-01-08 08:09:29`
- descriptionï¼šè¯¥è„šæœ¬ä¸“ä¸ºçƒ­é—¨è‚¡ç›‘æ§è®¾è®¡ï¼Œé‡ç‚¹è§£å†³å‡çº¿å–å‡ºæ»åé—®é¢˜ã€‚æ ¸å¿ƒé€»è¾‘åŒ…æ‹¬ï¼šå¼ºåŠ›æ¸…ä»“ï¼ˆè·Œç ´MA5ä¸”å›æ’¤>5%ï¼‰ã€é«˜ä½æ•æ„Ÿæ­¢ç›ˆï¼ˆæœªç ´å‡çº¿ä½†å›æ’¤>3%ä¸”æ”¶ç»¿ï¼‰ã€ä»¥åŠæ´—ç›˜ç»“æŸä¹°å…¥ï¼ˆMA20ä¸Šæ–¹é‡æ–°ç«™ç¨³MA5ï¼‰ã€‚é€šè¿‡åˆ†å±‚ä¿¡å·ï¼Œå…¼é¡¾äº†é«˜ä½é€ƒé¡¶æ•é”åº¦ä¸è¶‹åŠ¿è·Ÿè¸ªç¨³å®šæ€§ã€‚

### code

```python
# ==============================================================================
# è„šæœ¬åç§°ï¼šçƒ­é—¨è‚¡é«˜ä½æ´—ç›˜ç›‘æ§è„šæœ¬ (ä¼˜åŒ–ç‰ˆ)
# æ›´æ–°è¯´æ˜ï¼šé’ˆå¯¹çƒ­é—¨è‚¡å¢åŠ äº†â€œé«˜ä½æ•æ„Ÿæ­¢ç›ˆâ€é€»è¾‘ï¼Œè§£å†³å‡çº¿ä¹–ç¦»è¿‡å¤§å¯¼è‡´å–å‡ºæ»åçš„é—®é¢˜ã€‚
# æ ¸å¿ƒé€»è¾‘ï¼š
# 1. å¼ºåŠ›å–å‡ºï¼ˆæ¸…ä»“ï¼‰ï¼šè·Œç ´MA5 ä¸” å›æ’¤>5% (è¶‹åŠ¿ç ´å)
# 2. é¢„è­¦å–å‡ºï¼ˆå‡ä»“/æ¸…ç›˜å¼€å§‹ï¼‰ï¼šè™½æœªç ´MA5ï¼Œä½†ä»é«˜ç‚¹å›æ’¤>3% ä¸” ä»Šæ—¥æ”¶ç»¿ (é«˜ä½æ»æ¶¨)
# 3. ä¹°å…¥ï¼ˆæ´—ç›˜ç»“æŸï¼‰ï¼šç«™ç¨³MA20ï¼Œé‡æ–°çªç ´MA5ï¼Œä¸”æ˜¨æ—¥è¢«å‹åˆ¶ (ä¼ç¨³ååŒ…)
# ==============================================================================

# 1. åˆå§‹åŒ–æ ¸å¿ƒè¾“å‡ºå˜é‡
triggered = False
signal = "WAIT"
message = "ç›‘æ§ä¸­ï¼šç­‰å¾…ä¿¡å·..."

try:
    # 2. æ‰“å°è°ƒè¯•æ—¥å¿—
    print(f"[{datetime.datetime.now()}] æ‰§è¡Œçƒ­é—¨è‚¡ç›‘æ§: {symbol}")

    # 3. å¤„ç†è‚¡ç¥¨ä»£ç 
    symbol_code = symbol
    if symbol.startswith(("sh", "sz", "bj")):
        symbol_code = symbol[2:]

    # 4. æ‹‰å–è¡Œæƒ…æ•°æ®
    now = datetime.datetime.now()
    start_dt = (now - datetime.timedelta(days=90)).strftime("%Y%m%d")
    end_dt = now.strftime("%Y%m%d")
    
    df = ak.stock_zh_a_hist(symbol=symbol_code, period="daily", start_date=start_dt, end_date=end_dt, adjust="qfq")

    if df is None or df.empty or len(df) < 20:
        message = "æœªè§¦å‘ï¼šå†å²æ•°æ®ä¸è¶³"
    else:
        # 5. æ•°æ®å¤„ç†
        if 'æ—¥æœŸ' in df.columns:
            df.sort_values(by="æ—¥æœŸ", ascending=True, inplace=True)

        # è½¬æ¢ä¸ºæ•°å€¼
        for col in ['æ”¶ç›˜', 'æœ€é«˜', 'æœ€ä½', 'å¼€ç›˜']:
            df[col] = pd.to_numeric(df[col], errors='coerce')
        
        # è®¡ç®—æŒ‡æ ‡
        df['MA5'] = df['æ”¶ç›˜'].rolling(window=5).mean()
        df['MA20'] = df['æ”¶ç›˜'].rolling(window=20).mean()
        # 10æ—¥æœ€é«˜ä»·
        df['Highest_10'] = df['æœ€é«˜'].rolling(window=10, min_periods=1).max()

        # è·å–å½“å‰å’Œå‰ä¸€æ—¥æ•°æ®
        curr = df.iloc[-1]
        prev = df.iloc[-2]
        
        # æå–å…³é”®æ•°å€¼
        price = float(curr['æ”¶ç›˜'])
        prev_close = float(prev['æ”¶ç›˜'])
        ma5 = float(curr['MA5'])
        ma20 = float(curr['MA20'])
        high_10 = float(curr['Highest_10'])
        
        # è®¡ç®—å›æ’¤å¹…åº¦
        drawdown_pct = 0.0
        if high_10 > 0:
            drawdown_pct = (high_10 - price) / high_10

        print(f"ä»·:{price}, æ˜¨æ”¶:{prev_close}, MA5:{ma5:.2f}, 10æ—¥é«˜:{high_10}, å›æ’¤:{drawdown_pct:.2%}")

        # 6. æ ¸å¿ƒé€»è¾‘åˆ¤æ–­

        # --- åœºæ™¯Aï¼šè¶‹åŠ¿ç ´ä½ (Strong Sell) ---
        # é€»è¾‘ï¼šè·Œç ´MA5 ä¸” å›æ’¤æ˜æ˜¾ (>5%)ï¼Œè¿™æ˜¯ç¡®è®¤çš„ç¦»åœºç‚¹
        if price < ma5 and drawdown_pct > 0.05:
            triggered = True
            signal = "STRONG_SELL"
            message = f"ç¡®è®¤æ¸…ç›˜ï¼šè‚¡ä»·{price}æœ‰æ•ˆè·Œç ´MA5({ma5:.2f})ï¼Œå›æ’¤{drawdown_pct:.1%}ï¼Œè¶‹åŠ¿è½¬å¼±"

        # --- åœºæ™¯Bï¼šé«˜ä½æ»æ¶¨/æ—©æœŸæ¸…ç›˜ (Sensitive Sell) ---
        # é€»è¾‘ï¼šè™½æœªç ´MA5(å› ä¸ºMA5è¿˜å¾ˆä½)ï¼Œä½†é«˜ä½æ‰å¤´(å›æ’¤>3%) ä¸” ä»Šæ—¥æ”¶é˜´(ç°ä»·<æ˜¨æ”¶)
        # é’ˆå¯¹åŒ—æ–¹ååˆ›è¿™ç±»æ€¥æ¶¨åçš„å›è°ƒï¼Œè¿™ä¸€æ¡èƒ½è§¦å‘
        elif drawdown_pct > 0.03 and price < prev_close:
            triggered = True
            signal = "SELL"
            message = f"æ¸…ç›˜é¢„è­¦ï¼šé«˜ä½å›è°ƒ{drawdown_pct:.1%}ï¼Œè™½æœªç ´MA5ï¼Œä½†çŸ­çº¿æ»æ¶¨ï¼Œå»ºè®®é”å®šåˆ©æ¶¦"

        # --- åœºæ™¯Cï¼šæ´—ç›˜ç»“æŸ/ä¼ç¨³ (Buy) ---
        # é€»è¾‘ï¼šåœ¨MA20ç”Ÿå‘½çº¿ä¸Šæ–¹ï¼Œé‡æ–°ç«™ä¸ŠMA5
        elif price > ma5 and price > ma20 and prev['æ”¶ç›˜'] < prev['MA5']:
            triggered = True
            signal = "BUY"
            message = f"æ´—ç›˜ç»“æŸï¼šè‚¡ä»·{price}é‡æ–°ç«™ä¸ŠMA5ï¼Œè°ƒæ•´ç»“æŸï¼Œå¯ä»¥æ¥å›"

        # --- åœºæ™¯Dï¼šå¼ºåŠ¿æŒä»“ (Hold) ---
        # é€»è¾‘ï¼šåœ¨10æ—¥é«˜ç‚¹é™„è¿‘(å›æ’¤å°äº3%)ï¼Œæˆ–è€…è¿˜åœ¨åˆ›æ–°é«˜
        elif drawdown_pct <= 0.03:
            # åªæœ‰å½“ä¸ä»…æ²¡è·Œï¼Œè¿˜æ˜¯çº¢ç›˜æ—¶æ‰å«ä¸»å‡æµªï¼Œå¦åˆ™æ˜¯é«˜ä½éœ‡è¡
            if price >= prev_close:
                message = f"ä¸»å‡æµªä¸­ï¼šè‚¡ä»·åšæŒºï¼Œè·é«˜ç‚¹ä»…{drawdown_pct:.1%}ï¼Œç»§ç»­æŒæœ‰"
            else:
                 message = f"é«˜ä½éœ‡è¡ï¼šå›æ’¤{drawdown_pct:.1%}åœ¨æ­£å¸¸èŒƒå›´å†…ï¼Œå¯†åˆ‡å…³æ³¨"
            
        else:
            # --- åœºæ™¯Eï¼šåƒåœ¾æ—¶é—´ ---
            # ä»‹äº 3%-5% çš„å›æ’¤ä¹‹é—´ï¼Œä¸”æ²¡æœ‰ç ´MA5ï¼Œæ¯”è¾ƒå°´å°¬çš„ä½ç½®
            diff_ma5 = (price - ma5) / ma5
            message = f"å¼±åŠ¿éœ‡è¡ï¼šç°ä»·{price}ï¼Œå›æ’¤{drawdown_pct:.1%}ï¼Œæ”¯æ’‘ä½MA5:{ma5:.2f}"

except Exception as e:
    triggered = False
    signal = "WAIT"
    message = f"è¿è¡Œé”™è¯¯: {str(e)}"
```

## åŒ—äº¬å›æ­£ 1 æœˆ 7 æ—¥ç›‘æ§è„šæœ¬

- idï¼š`4`
- is_pinnedï¼š`0`
- updated_atï¼š`2026-01-06 07:47:45`

### code

```python
# -----------------------------------------------------------------------------
# è„šæœ¬åç§°ï¼šåŒ—äº¬å›æ­£ (300223) æŒä»“é˜²å®ˆã€çªç ´ä¸å¸ç­¹ç›‘æ§è„šæœ¬ v2.0
# é€‚ç”¨åœºæ™¯ï¼šå·²æŒä»“ï¼ŒåŸºäº2026/01/07åˆ†ææŠ¥å‘Š
# æ›´æ–°æ—¥å¿—ï¼š
#   v2.0: å¢åŠ â€œå¤šæ–¹ä½ä»·å¸ç­¹/æ´—ç›˜â€è¯†åˆ«é€»è¾‘ï¼Œé˜²æ­¢åœ¨é•¿ä¸‹å½±çº¿å¤„è¢«éœ‡ä»“å‡ºå±€
# æ ¸å¿ƒé€»è¾‘ï¼š
#   1. æ­¢æŸä¿æŠ¤ï¼šè·Œç ´ 121.0 (æ¸…ä»“) æˆ– 123.5 (å‡ä»“) -> [æ–°å¢] å¢åŠ æ´—ç›˜è±å…
#   2. çªç ´è·Ÿéšï¼šçªç ´ 128.0 (åŠ ä»“)
#   3. å¸ç­¹åˆ¤æ–­ï¼šæ”¯æ’‘ä½é™„è¿‘æ¢åº•å›å‡ (é•¿ä¸‹å½±çº¿) -> è§†ä¸ºä¹°å…¥æˆ–è§‚æœ›æœºä¼š
# -----------------------------------------------------------------------------

# --- 1. åˆå§‹åŒ–å˜é‡ ---
triggered = False
signal = "WAIT"
message = "ç›‘æ§ä¸­ï¼šæ•°æ®åŠ è½½..."

# --- 2. æ ¸å¿ƒå‚æ•°é…ç½® (åŸºäºæŠ¥å‘Š) ---
SYMBOL_CODE = "300223"  # åŒ—äº¬å›æ­£
PRICE_STOP_LOSS = 121.00  # å¼ºæ”¯æ’‘/æ­¢æŸçº¿ (MA10é™„è¿‘)
PRICE_REDUCE = 123.50     # å‡ä»“çº¿ (MA5/ç¬¬ä¸€æ”¯æ’‘)
PRICE_BREAKOUT = 128.00   # çªç ´åŠ ä»“çº¿ (æ•´æ•°å…³å£é˜»åŠ›)

# [æ–°å¢] å¸ç­¹åˆ¤å®šé˜ˆå€¼
ACCUMULATION_REBOUND_PCT = 1.5  # è·Œç ´åä»æœ€ä½ç‚¹åå¼¹è¶…è¿‡ 1.5%ï¼Œè§†ä¸ºæœ‰æ‰¿æ¥/å¸ç­¹
STRONG_ACCUMULATION_PCT = 2.5   # åå¼¹è¶…è¿‡ 2.5%ï¼Œè§†ä¸ºå¼ºåŠ›å¸ç­¹

try:
    # --- 3. è·å–å®æ—¶/å†å²æ•°æ® ---
    df_spot = ak.stock_zh_a_spot_em()
    row_spot = df_spot[df_spot['ä»£ç '] == SYMBOL_CODE]
    
    if row_spot.empty:
        message = f"æœªæ‰¾åˆ°ä»£ç  {SYMBOL_CODE} çš„å®æ—¶æ•°æ®"
    else:
        # æå–å½“å‰æ ¸å¿ƒæ•°æ®
        current_price = float(row_spot.iloc[0]['æœ€æ–°ä»·'])
        pct_change = float(row_spot.iloc[0]['æ¶¨è·Œå¹…'])
        highest = float(row_spot.iloc[0]['æœ€é«˜'])
        lowest = float(row_spot.iloc[0]['æœ€ä½'])
        open_price = float(row_spot.iloc[0]['ä»Šå¼€'])
        
        # [æ–°å¢] è®¡ç®—æ—¥å†…æ‰¿æ¥åŠ›æŒ‡æ ‡ (ä¸‹å½±çº¿åŠ›åº¦)
        # é€»è¾‘ï¼š(å½“å‰ä»· - æœ€ä½ä»·) / æœ€ä½ä»· * 100
        if lowest > 0:
            rebound_from_low = (current_price - lowest) / lowest * 100
        else:
            rebound_from_low = 0.0

        # è·å–å†å²æ•°æ® (ç”¨äºè®¡ç®—è¾…åŠ©æŒ‡æ ‡ KDJ/MA)
        end_date_str = datetime.datetime.now().strftime("%Y%m%d")
        start_date_str = (datetime.datetime.now() - datetime.timedelta(days=100)).strftime("%Y%m%d")
        
        df_hist = ak.stock_zh_a_hist(symbol=SYMBOL_CODE, period="daily", start_date=start_date_str, end_date=end_date_str, adjust="qfq")
        
        # KDJ è®¡ç®— (ç®€åŒ–ç‰ˆ)
        kdj_j = 50
        risk_tip = ""
        if df_hist is not None and not df_hist.empty:
            close_prices = pd.to_numeric(df_hist['æ”¶ç›˜'], errors='coerce')
            high_prices = pd.to_numeric(df_hist['æœ€é«˜'], errors='coerce')
            low_prices = pd.to_numeric(df_hist['æœ€ä½'], errors='coerce')
            window = 9
            if len(close_prices) >= window:
                low_9 = low_prices.rolling(window=window).min().iloc[-1]
                high_9 = high_prices.rolling(window=window).max().iloc[-1]
                # ä½¿ç”¨å½“å‰å®æ—¶ä»·æ ¼å‚ä¸è®¡ç®—ï¼Œæ›´çµæ•
                curr_low_9 = min(low_9, lowest)
                curr_high_9 = max(high_9, highest)
                
                rsv = (current_price - curr_low_9) / (curr_high_9 - curr_low_9) * 100 if (curr_high_9 - curr_low_9) != 0 else 50
                k_val = 50 * 2/3 + rsv * 1/3
                d_val = 50 * 2/3 + k_val * 1/3
                kdj_j = 3 * k_val - 2 * d_val

        if kdj_j > 100:
            risk_tip = " [æ³¨æ„ï¼šKDJé«˜ä½é’åŒ–]"

        # --- 4. é€»è¾‘åˆ¤æ–­ (å¢åŠ å¸ç­¹è±å…) ---
        
        # 4.1 ä¼˜å…ˆåˆ¤æ–­ï¼šæ˜¯å¦è§¦å‘ä½ä½å¼ºåŠ›å¸ç­¹ä¹°ç‚¹ (æ”¯æ’‘ä½é•¿ä¸‹å½±çº¿)
        # æ¡ä»¶ï¼šä»·æ ¼åœ¨å‡ä»“çº¿é™„è¿‘æˆ–ä¸‹æ–¹ï¼Œä½†å‡ºç°å·¨å¤§ä¸‹å½±çº¿æ‹‰å›
        if current_price < (PRICE_REDUCE + 1.0) and rebound_from_low > STRONG_ACCUMULATION_PCT:
             triggered = True
             signal = "BUY" # æ¿€è¿›ä¹°ç‚¹
             message = f"è§¦å‘ä½å¸ä¿¡å·ï¼šæ”¯æ’‘ä½æ¢åº•å›å‡ {rebound_from_low:.2f}%ï¼Œä¸»åŠ›å¸ç­¹æ˜æ˜¾ (ç°ä»· {current_price})"

        # 4.2 è§¦å‘å–å‡º (æ­¢æŸ/å‡ä»“) - å¸¦å¸ç­¹è±å…
        elif current_price < PRICE_STOP_LOSS:
            # è·Œç ´ 121 (å¼ºæ”¯æ’‘)ï¼Œå¿…é¡»ä¸¥æ ¼ï¼Œé™¤éç¬é—´æ‹‰å›å¹…åº¦æå¤§
            if rebound_from_low > STRONG_ACCUMULATION_PCT:
                triggered = True
                signal = "WAIT"
                message = f"è±å…æ­¢æŸï¼šè™½è·Œç ´121ï¼Œä½†Vå‹åè½¬æ‹‰å› {rebound_from_low:.2f}%ï¼Œç–‘ä¼¼å‡æ‘”æ´—ç›˜"
            else:
                triggered = True
                signal = "STRONG_SELL"
                message = f"è§¦å‘ä¸¥æ ¼æ­¢æŸï¼šç°ä»· {current_price} < {PRICE_STOP_LOSS} ä¸”æ— æœ‰æ•ˆæ‰¿æ¥ (10æ—¥çº¿å¤±æ•ˆ)"
            
        elif current_price < PRICE_REDUCE:
            # è·Œç ´ 123.5 (å‡ä»“çº¿)
            if rebound_from_low > ACCUMULATION_REBOUND_PCT:
                # [è±å…é€»è¾‘] è™½ç„¶è·Œç ´ï¼Œä½†ä»æœ€ä½ç‚¹åå¼¹è¶…è¿‡ 1.5%ï¼Œåˆ¤å®šä¸ºä¸‹å½±çº¿æ”¯æ’‘
                triggered = True
                signal = "WAIT"
                message = f"è§¦å‘æ´—ç›˜ä¿æŠ¤ï¼šè·Œç ´å‡ä»“çº¿ä½†æ¢åº•å›å‡ {rebound_from_low:.2f}%ï¼Œæš‚ä¸å‡ä»“"
            else:
                triggered = True
                signal = "SELL"
                message = f"è§¦å‘å‡ä»“ï¼šç°ä»· {current_price} < {PRICE_REDUCE} (5æ—¥çº¿æ”¯æ’‘è½¬å¼±)"
            
        # 4.3 è§¦å‘ä¹°å…¥ (çªç ´)
        elif current_price > PRICE_BREAKOUT:
            triggered = True
            signal = "STRONG_BUY"
            message = f"è§¦å‘çªç ´åŠ ä»“ï¼šç°ä»· {current_price} > {PRICE_BREAKOUT} (çªç ´128å‹åŠ›ä½)"
            
        # 4.4 è§‚æœ›
        else:
            triggered = True
            signal = "WAIT"
            
            # è§‚æœ›æ—¶çš„æ–‡æ¡ˆç»†åŒ–
            if rebound_from_low > 1.0:
                accum_msg = f"ï¼Œæ—¥å†…æœ‰{rebound_from_low:.1f}%å›å‡"
            else:
                accum_msg = ""
                
            dist_down = round(current_price - PRICE_REDUCE, 2)
            message = (f"æŒä»“è§‚æœ›ï¼šç°ä»· {current_price}{accum_msg}ã€‚\n"
                       f"å®‰å…¨å« {dist_down}å…ƒ{risk_tip}")

except Exception as e:
    triggered = False
    signal = "WAIT"
    message = f"è„šæœ¬æ‰§è¡Œå¼‚å¸¸ï¼š{str(e)}"
    print(f"DEBUG Error: {e}")
```

## å››å·ä¹æ´² è·Ÿè¸ª

- idï¼š`3`
- is_pinnedï¼š`0`
- updated_atï¼š`2026-01-04 09:13:33`
- descriptionï¼šå¦‚æœ å››å·ä¹æ´² å“äº†ï¼Œè¯´æ˜å¸‚åœºåœ¨ç‚’**â€œä½ç©ºç»æµä¿®å¤â€**ï¼Œèµ°åŠ¿ä¼šç›¸å¯¹æ¸©å’Œä¸€ç‚¹ã€‚æ— è®ºå“ªä¸ªè„šæœ¬è§¦å‘ï¼Œä¹°å…¥åä¸€æ—¦è‚¡ä»·æ‰å¤´è·Œç ´åˆ†æ—¶å‡çº¿ï¼ˆé»„è‰²çº¿ï¼‰ï¼Œå¯¹äºèµšå¿«é’±çš„ç­–ç•¥æ¥è¯´ï¼Œå°±æ˜¯ç¦»åœºä¿¡å·ã€‚

### code

```python
# -----------------------------------------------------------------------------
# è„šæœ¬åç§°ï¼šå››å·ä¹æ´²-ä½ç©ºåå‡»ç‰¹åŒ–ç‰ˆ (ä¸€æ¬¡æ€§ç‹™å‡»)
# æ ¸å¿ƒç­–ç•¥ï¼šæ‹’ç»å¤§å¹…é«˜å¼€ + ç¡®è®¤æŠ—è·Œæ€§ + å®ä½“é˜³çº¿çªç ´
# è¿è¡Œå»ºè®®ï¼šå‘¨ä¸€ä¸Šåˆ 09:25 - 10:30 å¼€å¯ï¼Œè§¦å‘ä¹°å…¥æˆ–æ˜ç¡®æ”¾å¼ƒååœæ­¢ã€‚
# -----------------------------------------------------------------------------

triggered = False
signal = "WAIT"
message = "ä½ç©ºé›·è¾¾æ‰«æä¸­..."

try:
    # 1. ã€æ—¶é—´çª—å£ã€‘
    # å››å·ä¹æ´²ä½œä¸ºä¸­å†›ï¼ŒåŠ¨ä½œå¯èƒ½æ¯”å¦–è‚¡æ…¢åŠæ‹ï¼Œè§‚å¯ŸæœŸç¨å¾®å»¶åä¸€ç‚¹ç‚¹
    now_time = datetime.datetime.now().time()
    start_window = datetime.time(9, 35) # ç¨å¾®æ—©ä¸€ç‚¹çœ‹å®ƒæ˜¯å¦æŠ—è·Œ
    end_window = datetime.time(10, 20)
    
    if now_time < start_window:
        message = f"æœªåˆ°æ‰«ææ—¶é—´ï¼šå½“å‰{now_time.strftime('%H:%M')}ï¼Œç­‰å¾…å¼€ç›˜æƒ…ç»ªç¨³å®š"
    elif now_time > end_window:
        message = "çª—å£æœŸå·²è¿‡ï¼šæ—©ç›˜é»„é‡‘åšå¼ˆæœŸç»“æŸï¼Œä¸å†å¼€æ–°ä»“"
    else:
        # 2. ã€æ•°æ®è·å–ã€‘
        symbol_code = symbol
        if symbol.startswith(("sh", "sz", "bj")):
            symbol_code = symbol[2:]
            
        # è·å–æ—¥çº¿æ•°æ® (å«ä»Šæ—¥)
        df = ak.stock_zh_a_hist(symbol=symbol_code, period="daily", start_date="20250101", adjust="qfq")
        
        if df is None or len(df) < 2:
            message = "æ•°æ®ä¸è¶³ï¼Œæ— æ³•è®¡ç®—"
        else:
            today_row = df.iloc[-1]
            yesterday_row = df.iloc[-2]
            
            # åŸºç¡€æ•°æ®
            last_close = yesterday_row['æ”¶ç›˜']
            open_price = today_row['å¼€ç›˜']
            current_price = today_row['æ”¶ç›˜'] # ç°ä»·
            low_price = today_row['æœ€ä½']
            high_price = today_row['æœ€é«˜']
            
            # æ¶¨å¹…è®¡ç®—
            open_pct = (open_price - last_close) / last_close * 100
            current_pct = (current_price - last_close) / last_close * 100
            
            # 3. ã€æ ¸å¿ƒåˆ¤å®šé€»è¾‘ã€‘
            
            # æ’é™¤æ¡ä»¶ Aï¼šé«˜å¼€å¤ªå¤š (ä½œä¸ºä¸­å†›ï¼Œå¼€åœ¨+3%ä»¥ä¸Šå¾€å¾€æ˜¯å–ç‚¹)
            is_too_high = open_pct > 3.0
            
            # æ’é™¤æ¡ä»¶ Bï¼šä¸¥é‡ä½å¼€ (è¯´æ˜ä½ç©ºæ¿å—ä»Šå¤©æ²¡æˆ)
            is_too_low = open_pct < -3.0
            
            if is_too_high:
                triggered = True
                signal = "WAIT"
                message = f"ã€æ”¾å¼ƒã€‘å¼€ç›˜è¿‡é«˜(+{open_pct:.2f}%)ï¼Œé€æ”¯æ—¥å†…ç©ºé—´ï¼Œä¸è¿½"
            
            elif is_too_low:
                triggered = True
                signal = "WAIT"
                message = f"ã€æ”¾å¼ƒã€‘å¼€ç›˜è¿‡å¼±({open_pct:.2f}%)ï¼Œæ¿å—æƒ…ç»ªä¸ä½³"
                
            else:
                # ä¹°å…¥æ¡ä»¶ Cï¼šæŠ—è·Œåå‡» (å…³é”®ï¼)
                # é€»è¾‘ï¼šç°ä»· > å¼€ç›˜ä»· (æ”¶çº¢å®ä½“é˜³çº¿) ä¸” ç°ä»· > æ˜¨æ”¶ (æ•´ä½“ç¿»çº¢)
                is_red_solid = (current_price > open_price) and (current_price > last_close)
                
                # ä¹°å…¥æ¡ä»¶ Dï¼šåŠ›åº¦ç¡®è®¤
                # é€»è¾‘ï¼šæ¶¨å¹…åœ¨ 1% ~ 5% ä¹‹é—´ (å¤ªå°æ²¡åŠ²ï¼Œå¤ªå¤§å®¹æ˜“å›è½)
                is_good_momentum = 1.0 < current_pct < 5.0
                
                # ä¹°å…¥æ¡ä»¶ Eï¼šå¿…é¡»è„±ç¦»æœ€ä½ç‚¹ (ç¡®è®¤æœ‰æ‰¿æ¥)
                # ç°ä»·å·²ç»æ¯”ä»Šæ—¥æœ€ä½ä»·é«˜å‡ºè‡³å°‘ 0.5%
                has_support = current_price > (low_price * 1.005)

                if is_red_solid and is_good_momentum and has_support:
                    triggered = True
                    signal = "BUY"
                    message = f"ã€ç¡®è®¤åå‡»ã€‘ä½ç©ºä¼ç¨³ï¼ç°ä»·{current_price}(+{current_pct:.2f}%)ï¼Œå®ä½“ç¿»çº¢ï¼Œå¯è¿›åœºåšT"
                
                # æ­¢æŸé¢„è­¦ï¼šå¦‚æœæ—©ç›˜å°±å¤§è·Œ
                elif current_pct < -4.0:
                    triggered = True
                    signal = "SELL" # æˆ–è€… STRONG_SELL
                    message = f"ã€é£é™©æç¤ºã€‘ä½ç©ºæ¿å—æ€è·Œï¼Œç°ä»·{current_price}({current_pct:.2f}%)ï¼Œæ³¨æ„å›é¿"
                
                else:
                    triggered = False
                    message = f"æ‰«æä¸­ï¼šç°ä»·{current_price} | æ¶¨å¹…{current_pct:.2f}% | éœ€ç­‰å¾…æ¶¨å¹…>1%ä¸”ç¿»çº¢"

except Exception as e:
    triggered = False
    message = f"é”™è¯¯ï¼š{str(e)}"
```

## ä¸‡å‘é’±æ½®ç›¯ç›˜è„šæœ¬

- idï¼š`2`
- is_pinnedï¼š`0`
- updated_atï¼š`2026-01-04 09:13:29`
- descriptionï¼šå¦‚æœ ä¸‡å‘é’±æ½® å“äº†ï¼Œè¯´æ˜å¸‚åœºåœ¨ç‚’**â€œå¼±è½¬å¼ºâ€**çš„æƒ…ç»ªï¼Œé£é™©å¤§æ”¶ç›Šå¤§ã€‚æ— è®ºå“ªä¸ªè„šæœ¬è§¦å‘ï¼Œä¹°å…¥åä¸€æ—¦è‚¡ä»·æ‰å¤´è·Œç ´åˆ†æ—¶å‡çº¿ï¼ˆé»„è‰²çº¿ï¼‰ï¼Œå¯¹äºèµšå¿«é’±çš„ç­–ç•¥æ¥è¯´ï¼Œå°±æ˜¯ç¦»åœºä¿¡å·ã€‚

### code

```python
# -----------------------------------------------------------------------------
# è„šæœ¬åç§°ï¼šä¸‡å‘é’±æ½®-æ—©ç›˜ç‹™å‡»ç‰¹åŒ–ç‰ˆ (ä¸€æ¬¡æ€§ä½¿ç”¨)
# æ ¸å¿ƒç­–ç•¥ï¼šæ—¶é—´çª—ç‹™å‡» + å¼±è½¬å¼ºåšå¼ˆ
# è¿è¡Œå»ºè®®ï¼šä»…åœ¨å‘¨ä¸€ä¸Šåˆ 09:25 - 10:30 å¼€å¯ä»»åŠ¡ï¼Œè§¦å‘ä¸€æ¬¡åå³å¯æ‰‹åŠ¨åœæ­¢ä»»åŠ¡ã€‚
# -----------------------------------------------------------------------------

triggered = False
signal = "WAIT"
message = "ç‹™å‡»é•œæ ¡å‡†ä¸­..."

try:
    # 1. ã€æ—¶é—´é”ã€‘ä¸¥æ ¼çš„æ—¶é—´çª—å£æ§åˆ¶
    # é€»è¾‘ï¼š9:40å‰ä¸çœ‹ï¼ˆé¿å¼€å‡åŠ¨ä½œï¼‰ï¼Œ10:15åä¸è¿½ï¼ˆé˜²æ­¢å†²é«˜å›è½ï¼‰
    now_time = datetime.datetime.now().time()
    start_window = datetime.time(9, 40)
    end_window = datetime.time(22, 15)
    
    if now_time < start_window:
        message = f"æœªåˆ°ç‹™å‡»æ—¶é—´ï¼šå½“å‰{now_time.strftime('%H:%M')}ï¼Œé™å¾…09:40å¸‚åœºåˆ†æ­§é‡Šæ”¾"
    elif now_time > end_window:
        message = "çª—å£æœŸå·²è¿‡ï¼š10:15åä¸å†å¼€æ–°ä»“ï¼Œé¿å…é«˜ä½ç«™å²—"
    else:
        # 2. ã€æ•°æ®æºã€‘è·å–å®æ—¶è¡Œæƒ…
        symbol_code = symbol
        if symbol.startswith(("sh", "sz", "bj")):
            symbol_code = symbol[2:]
            
        # è·å–æœ€è¿‘ä¸¤æ—¥æ•°æ®ï¼ˆæ˜¨æ—¥æ”¶ç›˜ + ä»Šæ—¥å®æ—¶ï¼‰
        df = ak.stock_zh_a_hist(symbol=symbol_code, period="daily", start_date="20250101", adjust="qfq")
        
        if df is None or len(df) < 2:
            message = "æ•°æ®ä¸è¶³ï¼Œæ— æ³•è®¡ç®—"
        else:
            today_row = df.iloc[-1]
            yesterday_row = df.iloc[-2]
            
            # å…³é”®ä»·æ ¼ç‚¹ä½
            last_close = yesterday_row['æ”¶ç›˜']  # æ˜¨æ”¶ï¼ˆåŸºå‡†çº¿ï¼‰
            open_price = today_row['å¼€ç›˜']      # ä»Šå¼€
            current_price = today_row['æ”¶ç›˜']   # ç°ä»·ï¼ˆakshareå³æ—¶æ•°æ®ä¸­æ”¶ç›˜å³ç°ä»·ï¼‰
            low_price = today_row['æœ€ä½']       # ä»Šæ—¥æœ€ä½
            
            # è®¡ç®—æ¶¨å¹…
            pct_chg = (current_price - last_close) / last_close * 100
            
            # 3. ã€ç‹™å‡»åˆ¤å®šã€‘ä¸‰å¤§æ ¸å¿ƒæ¡ä»¶
            
            # æ¡ä»¶Aï¼šæ‹’ç»é«˜å¼€è¯±å¤š
            # å¦‚æœå¼€ç›˜å°±æ¶¨è¶… 4%ï¼Œç›´æ¥æ”¾å¼ƒï¼Œè‚‰å°‘é£é™©å¤§
            is_safe_open = open_price < (last_close * 1.04)
            
            # æ¡ä»¶Bï¼šå¿…é¡»æœ‰â€œä¸‹æ€â€åŠ¨ä½œï¼ˆææ…Œç›˜å·²å‡ºï¼‰
            # ä»Šæ—¥æœ€ä½ä»·å¿…é¡»ä½äºå¼€ç›˜ä»·è‡³å°‘ 0.5%ï¼Œè¯´æ˜æœ‰äººç ¸è¿‡ç›˜äº†
            has_dip = low_price < (open_price * 0.995)
            
            # æ¡ä»¶Cï¼šå¼±è½¬å¼ºï¼ˆå…³é”®ä¿¡å·ï¼‰
            # ç°ä»·å·²ç»æ‹‰å›å¹¶åœ¨å¼€ç›˜ä»·ä¹‹ä¸Šï¼Œä¸”æ¶¨å¹…ä¸ºæ­£ï¼ˆç¿»çº¢ï¼‰
            is_reversal = (current_price > open_price) and (current_price > last_close)
            
            # æ¡ä»¶Dï¼šæ¶¨å¹…æ§åˆ¶ï¼ˆåªåƒé±¼èº«ï¼‰
            # æ¶¨å¹…åœ¨ 0% ~ 5% ä¹‹é—´æ˜¯æœ€ä½³ä¹°ç‚¹ï¼Œè¶…è¿‡ 6% å°±ä¸è¿½äº†
            is_good_range = 0.0 < pct_chg < 6.0
            
            # --- æœ€ç»ˆåˆ¤å®š ---
            if is_safe_open and has_dip and is_reversal and is_good_range:
                triggered = True
                signal = "BUY" # æˆ–è€… "STRONG_BUY"
                message = f"ã€ç‹™å‡»å‘½ä¸­ã€‘Vå‹åè½¬ï¼æ›¾è·Œè‡³{low_price}ï¼Œç°ä»·{current_price}(+{pct_chg:.2f}%)ç¿»çº¢ï¼Œææ…Œç›˜å·²æ¸…æ´—"
            
            # ç‰¹æ®Šæƒ…å†µï¼šå¦‚æœåœ¨è¿™ä¸ªæ—¶é—´ç‚¹è·Œç ´äº†æ˜¨æ”¶ç›˜ä¸”è·Œå¹…æ‰©å¤§ï¼Œæç¤ºé£é™©
            elif current_price < last_close and pct_chg < -2.0:
                triggered = True
                signal = "WAIT" # æ˜ç¡®çš„è§‚æœ›ä¿¡å·
                message = f"ã€æ”¾å¼ƒä¿¡å·ã€‘æŒç»­èµ°å¼±ï¼Œè·Œå¹…{pct_chg:.2f}%ï¼Œæœªå‡ºç°æ‰¿æ¥"
            
            else:
                triggered = False
                message = f"ç›‘æ§ä¸­ï¼š{now_time.strftime('%H:%M')} | ç°ä»·{current_price} | æ¶¨å¹…{pct_chg:.2f}% | ç­‰å¾…ç¿»çº¢ä¿¡å·"

except Exception as e:
    triggered = False
    message = f"é”™è¯¯ï¼š{str(e)}"
```

## åŒå‘çŒæ€ç›‘æ§ç­–ç•¥

- idï¼š`1`
- is_pinnedï¼š`0`
- updated_atï¼š`2025-12-26 04:03:50`

### code

```python
# ==============================================================================
# åŒå‘çŒæ€ç›‘æ§ (Hybrid Hunter) - å¢å¼ºç‰ˆ
# ------------------------------------------------------------------------------
# ä¼˜åŒ–ç‚¹ï¼šå¢åŠ â€œéäº¤æ˜“æ—¶æ®µâ€çš„é™çº§å¤„ç†ï¼Œæ— åˆ†æ—¶æ•°æ®æ—¶ä½¿ç”¨æ˜¨æ—¥æ”¶ç›˜æ•°æ®è¿›è¡Œæ¨æ¼”
# ==============================================================================

import pandas as pd
import numpy as np
import datetime
import akshare as ak

# 1. åˆå§‹åŒ–
triggered = False
signal = "WAIT"
message = "ç›‘æ§ä¸­ï¼šå¤šç©ºåŒå‘æ‰«æ..."

# 2. å‚æ•°é…ç½®
# --- ä¹°å…¥å‚æ•° (Hyena) ---
BUY_ALPHA_THRESHOLD = 0.6       # ä¹°å…¥è¦æ±‚ï¼šAlphaå¿…é¡» > 0.6
BUY_PIN_BAR_RATIO = 1.8         # ä¹°å…¥å½¢æ€ï¼šä¸‹å½±çº¿ > å®ä½“ 1.8å€
BUY_BREAK_MA_THRESHOLD = 0.005  # ä¹°å…¥å½¢æ€ï¼šç«™ç¨³å‡ä»·çº¿ 0.5%

# --- å–å‡ºå‚æ•° (Vulture) ---
SELL_BREAK_MA_THRESHOLD = 0.005 # å–å‡ºå½¢æ€ï¼šè·Œç ´å‡ä»·çº¿ 0.5%
SELL_SHOOTING_STAR_RATIO = 1.8  # å–å‡ºå½¢æ€ï¼šä¸Šå½±çº¿ > å®ä½“ 1.8å€

try:
    # 3. é¢„å¤„ç† Symbol
    symbol_code = symbol
    if symbol.startswith(("sh", "sz", "bj")):
        symbol_code = symbol[2:]

    # 4. æ—¶é—´è®¾å®š
    now = datetime.datetime.now()
    today_str_start = now.strftime("%Y-%m-%d 00:00:00")
    today_str_end = now.strftime("%Y-%m-%d 23:59:59")
    yesterday_str = (now - datetime.timedelta(days=1)).strftime("%Y%m%d")
    start_dt_str = (now - datetime.timedelta(days=60)).strftime("%Y%m%d")

    # ==========================================
    # æ­¥éª¤ A: è·å–æ•°æ® (å†å² + å®æ—¶)
    # ==========================================
    # 1) è·å–å†å²æ—¥çº¿ (ç”¨äºè®¡ç®— Alpha å’Œ é™çº§æ•°æ®)
    df_hist = ak.stock_zh_a_hist(symbol=symbol_code, period="daily", start_date=start_dt_str, end_date=yesterday_str, adjust="qfq")
    
    # 2) å°è¯•è·å–ä»Šæ—¥åˆ†æ—¶
    try:
        df_min = ak.stock_zh_a_hist_min_em(symbol=symbol_code, start_date=today_str_start, end_date=today_str_end, period='1', adjust='')
    except:
        df_min = pd.DataFrame() # è·å–å¤±è´¥åˆ™ä¸ºç©º

    if df_hist is None or df_hist.empty:
        message = "æœªè§¦å‘ï¼šå†å²æ•°æ®ä¸è¶³"
    else:
        # æ•°æ®æ¸…æ´— - å†å²
        # æ³¨æ„ï¼šè¿™é‡Œå¤šé‡å‘½åäº† 'æˆäº¤é¢' ç”¨äºè®¡ç®—å†å² VWAP
        df_hist = df_hist.rename(columns={"æ—¥æœŸ": "date", "å¼€ç›˜": "open", "æ”¶ç›˜": "close", "æœ€é«˜": "high", "æœ€ä½": "low", "æˆäº¤é‡": "volume", "æˆäº¤é¢": "amount"})
        cols = ["open", "close", "high", "low", "volume", "amount"]
        df_hist[cols] = df_hist[cols].apply(pd.to_numeric, errors='coerce')

        # ----------------------------------------------------
        # æ ¸å¿ƒä¿®æ”¹é€»è¾‘ï¼šåˆ¤æ–­æ˜¯ç”¨â€œå®æ—¶æ•°æ®â€è¿˜æ˜¯â€œå†å²é™çº§æ•°æ®â€
        # ----------------------------------------------------
        use_live_data = False
        
        # æ£€æŸ¥åˆ†æ—¶æ•°æ®æ˜¯å¦å­˜åœ¨ä¸”æ˜¯å¦åŒ…å«ä»Šæ—¥
        if df_min is not None and not df_min.empty:
            df_min['æ—¶é—´'] = pd.to_datetime(df_min['æ—¶é—´'])
            df_today = df_min[df_min['æ—¶é—´'].dt.date == now.date()]
            if not df_today.empty:
                use_live_data = True

        # ==========================================
        # æ­¥éª¤ B: æ ¸å¿ƒæŒ‡æ ‡è®¡ç®— (æ ¹æ®æ•°æ®æºåˆ†æ”¯)
        # ==========================================
        
        if use_live_data:
            # ---> åœºæ™¯ 1: å¼€ç›˜æ—¶é—´ï¼Œä½¿ç”¨å®æ—¶æ•°æ®
            mode_label = "ğŸ”´å®æ—¶"
            live_open = float(df_today.iloc[0]['å¼€ç›˜'])
            live_close = float(df_today.iloc[-1]['æ”¶ç›˜'])
            live_high = float(df_today['æœ€é«˜'].max())
            live_low = float(df_today['æœ€ä½'].min())
            live_volume = float(df_today['æˆäº¤é‡'].sum()) 
            live_amount = float(df_today['æˆäº¤é¢'].sum()) 
            
            # å®æ—¶ VWAP
            if live_volume > 0:
                live_vwap = live_amount / (live_volume * 100) # å‡è®¾å•ä½è½¬æ¢æ­£ç¡®
            else:
                live_vwap = live_close
                
        else:
            # ---> åœºæ™¯ 2: éäº¤æ˜“æ—¶é—´/ç›˜å‰ï¼Œé™çº§ä½¿ç”¨æ˜¨æ—¥æ”¶ç›˜æ•°æ®
            mode_label = "ğŸ”µç›˜å‰"
            last_row = df_hist.iloc[-1]
            live_open = float(last_row['open'])
            live_close = float(last_row['close'])
            live_high = float(last_row['high'])
            live_low = float(last_row['low'])
            live_volume = float(last_row['volume'])
            live_amount = float(last_row['amount'])
            
            # å†å² VWAP (ç”¨æ˜¨æ—¥å‡ä»·æ¨¡æ‹Ÿ)
            if live_volume > 0:
                live_vwap = live_amount / (live_volume * 100) # è¿™é‡Œéœ€è¦ç¡®è®¤akshareå•ä½ï¼Œé€šå¸¸é‡‘é¢æ˜¯å…ƒï¼Œé‡æ˜¯æ‰‹
            else:
                live_vwap = (live_open + live_close + live_high + live_low) / 4

        # --- 3. è®¡ç®— Alpha #2 ---
        # æ„é€ è®¡ç®—ç”¨çš„ DataFrame
        if use_live_data:
            snapshot_data = {
                "date": now.strftime("%Y-%m-%d"), "open": live_open, "close": live_close, 
                "high": live_high, "low": live_low, "volume": live_volume
            }
            # å¦‚æœæ˜¯å®æ—¶ï¼Œæ‹¼æ¥åˆ°å†å²æ•°æ®åè®¡ç®—
            df_calc = pd.concat([df_hist, pd.DataFrame([snapshot_data])], ignore_index=True)
        else:
            # å¦‚æœæ˜¯ç›˜å‰ï¼Œç›´æ¥ä½¿ç”¨å†å²æ•°æ®è®¡ç®—ï¼Œä¸éœ€è¦æ‹¼æ¥ï¼ˆå› ä¸ºæœ€åä¸€è¡Œå·²ç»æ˜¯æ˜¨å¤©äº†ï¼‰
            df_calc = df_hist.copy()

        # Alpha è®¡ç®—é€»è¾‘ (é€šç”¨)
        if len(df_calc) >= 10:
            df_calc['log_vol'] = np.log(df_calc['volume'] + 1)
            df_calc['delta_vol'] = df_calc['log_vol'].diff(2)
            df_calc['alpha_ret'] = (df_calc['close'] - df_calc['open']) / df_calc['open']
            df_calc['corr'] = df_calc['delta_vol'].rolling(window=6).corr(df_calc['alpha_ret'])
            curr_alpha = -1 * df_calc.iloc[-1]['corr']
            # å¤„ç† NaN
            if pd.isna(curr_alpha): curr_alpha = 0.0
        else:
            curr_alpha = 0.0 
            
        # --- 4. å½¢æ€åŸºç¡€è®¡ç®— ---
        body_len = abs(live_close - live_open)
        if body_len == 0: body_len = 0.001
        
        upper_shadow = live_high - max(live_open, live_close)
        shooting_star_ratio = upper_shadow / body_len
        
        lower_shadow = min(live_open, live_close) - live_low
        pin_bar_ratio = lower_shadow / body_len
        
        is_red = live_close > live_open
        is_green = live_close < live_open

        # ==========================================
        # æ­¥éª¤ C: å†³ç­–é€»è¾‘ (åŒå‘åˆ¤å®š)
        # ==========================================

        # ----------------------------------
        # åˆ¤å®š 1: å–å‡ºä¿¡å· (Vulture)
        # ----------------------------------
        sell_reasons = []
        
        # å–å‡ºæ¡ä»¶A: è·Œç ´å‡çº¿
        pct_under_vwap = (live_vwap - live_close) / live_vwap
        if pct_under_vwap > SELL_BREAK_MA_THRESHOLD:
            sell_reasons.append(f"è·Œç ´å‡çº¿({live_vwap:.2f})")
        
        # å–å‡ºæ¡ä»¶B: æµæ˜Ÿçº¿
        if shooting_star_ratio > SELL_SHOOTING_STAR_RATIO:
            sell_reasons.append("æµæ˜Ÿçº¿(å†²é«˜å›è½)")
        
        if sell_reasons:
            triggered = True
            signal = "STRONG_SELL"
            message = f"{mode_label}ã€ç§ƒé¹«å–å‡ºã€‘ç©ºå¤´æ§ç›˜ | {'+'.join(sell_reasons)} | ç°ä»·:{live_close} < å‡ä»·:{live_vwap:.2f}"
        
        else:
            # ----------------------------------
            # åˆ¤å®š 2: ä¹°å…¥ä¿¡å· (Hyena)
            # ----------------------------------
            buy_reasons = []
            
            if curr_alpha > BUY_ALPHA_THRESHOLD:
                # ä¹°å…¥æ¡ä»¶A: ç«™ç¨³å‡çº¿
                pct_over_vwap = (live_close - live_vwap) / live_vwap
                if pct_over_vwap > BUY_BREAK_MA_THRESHOLD:
                    buy_reasons.append(f"ç«™ç¨³å‡çº¿({live_vwap:.2f})")
                
                # ä¹°å…¥æ¡ä»¶B: é‡‘é’ˆæ¢åº•
                if (pin_bar_ratio > BUY_PIN_BAR_RATIO) and is_red:
                    buy_reasons.append("é‡‘é’ˆæ¢åº•")
                
                if buy_reasons:
                    triggered = True
                    signal = "STRONG_BUY"
                    message = f"{mode_label}ã€é¬£ç‹—è¿›æ”»ã€‘Alpha({curr_alpha:.2f})ç¡®è®¤ + {'+'.join(buy_reasons)} | ç°ä»·:{live_close}"
                else:
                    triggered = False
                    signal = "WAIT"
                    message = f"{mode_label} é”å®šçŒç‰©ï¼šAlpha({curr_alpha:.2f})é«˜ï¼Œç­‰å¾…æ”»å‡»å½¢æ€ (å‡ä»·:{live_vwap:.2f})"
            else:
                triggered = False
                signal = "WAIT"
                message = f"{mode_label} æœªè§¦å‘ï¼šå¤šç©ºå¹³è¡¡ (Alpha:{curr_alpha:.2f} / å‡ä»·:{live_vwap:.2f})"

except Exception as e:
    triggered = False
    signal = "WAIT"
    message = f"è„šæœ¬é”™è¯¯ï¼š{str(e)}"
    print(f"[Error] {e}")

# æœ€ç»ˆä¸ºäº†è°ƒè¯•ï¼Œå¯ä»¥æ‰“å°ä¸€ä¸‹
# print(message)
```
